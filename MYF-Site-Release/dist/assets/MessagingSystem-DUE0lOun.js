import{c as B,a as F,e as G,r as i,b as x,R as K,j as e,X as P,S as V,U as y,m as X}from"./index-B4Yke-v_.js";import{L as A}from"./loader-wdVofJor.js";import{C as H}from"./check-qX3W8KHs.js";import{S as J}from"./send-yV-KYsjC.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Y=B("check-check",W);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],U=B("menu",Z),ie=({initialSelectedUserId:N})=>{const{user:l}=F(),k=G(),[d,h]=i.useState([]),[f,D]=i.useState([]),[a,g]=i.useState(null),[m,I]=i.useState(""),[_,M]=i.useState(!0),[p,S]=i.useState(!1),[ee,te]=i.useState(!1),[q,b]=i.useState(!1),[u,z]=i.useState(""),C=i.useRef(null),o=(l==null?void 0:l.role)==="admin";i.useEffect(()=>{O();const t=setInterval(j,1e4);return()=>clearInterval(t)},[]),i.useEffect(()=>{L()},[d,a]);const L=()=>{var t;(t=C.current)==null||t.scrollIntoView({behavior:"smooth"})},O=async()=>{M(!0);try{if(o){const[t,r]=await Promise.all([x.getMessages(),x.getStudents()]);if(h(t),D(r),N){const s=r.find(n=>n.id===N);s&&g(s)}}else{const t=await x.getMessages();h(t),g({id:"2",name:"Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ",role:"admin"})}}catch(t){console.error(t),k.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„")}finally{M(!1)}},j=async()=>{try{const t=await x.getMessages();h(t)}catch{}},R=async()=>{if(!(!m.trim()||!a&&o)){S(!0);try{const t=o?a.id:"2",r=await x.sendMessage(t,m);h(s=>[...s,r]),I(""),L()}catch{k.error("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©")}finally{S(!1)}}},T=()=>o?a?d.filter(t=>t.senderId===(l==null?void 0:l.id)&&t.receiverId===a.id||t.receiverId===(l==null?void 0:l.id)&&t.senderId===a.id):[]:d,E=K.useMemo(()=>{let t=f;if(u.trim()){const r=u.toLowerCase();t=f.filter(s=>{var n;return s.name.toLowerCase().includes(r)||((n=s.email)==null?void 0:n.toLowerCase().includes(r))})}return t.sort((r,s)=>{const n=d.filter(c=>c.senderId===r.id&&!c.read).length,$=d.filter(c=>c.senderId===s.id&&!c.read).length;if(n!==$)return $-n;const v=d.filter(c=>c.senderId===r.id||c.receiverId===r.id),w=d.filter(c=>c.senderId===s.id||c.receiverId===s.id),Q=v.length>0?new Date(v[v.length-1].timestamp).getTime():0;return(w.length>0?new Date(w[w.length-1].timestamp).getTime():0)-Q})},[f,d,u]);return _?e.jsx("div",{className:"flex justify-center p-10",children:e.jsx(A,{className:"animate-spin text-white"})}):e.jsxs("div",{className:"flex h-[calc(100vh-140px)] glass-panel overflow-hidden rounded-2xl border border-white/10 relative",children:[o&&e.jsxs("div",{className:`
            absolute md:relative z-20 w-full md:w-80 h-full bg-black/95 md:bg-transparent transition-transform duration-300 border-l border-white/5 flex flex-col
            ${q?"translate-x-0":"translate-x-full md:translate-x-0"}
        `,children:[e.jsxs("div",{className:"p-4 border-b border-white/5 bg-white/5 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center bg-transparent",children:[e.jsx("h3",{className:"font-bold text-white",children:"Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª"}),e.jsx("button",{onClick:()=>b(!1),className:"md:hidden text-gray-400",children:e.jsx(P,{})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨...",value:u,onChange:t=>z(t.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-violet-500/50 pr-8"}),e.jsx(V,{className:"absolute right-2.5 top-2.5 w-4 h-4 text-gray-500"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2",children:E.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4 text-sm",children:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨"}):E.map(t=>{const r=d.filter(n=>n.senderId===t.id&&!n.read).length,s=d.filter(n=>n.senderId===t.id||n.receiverId===t.id).pop();return e.jsxs("button",{onClick:async()=>{if(g(t),b(!1),r>0)try{await x.markConversationAsRead(t.id),j()}catch(n){console.error("Failed to mark read",n)}},className:`w-full p-3 rounded-lg flex items-center gap-3 transition-colors ${(a==null?void 0:a.id)===t.id?"bg-violet-600/20 border border-violet-500/30":"hover:bg-white/5"}`,children:[e.jsxs("div",{className:"relative",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center",children:e.jsx(y,{className:"w-5 h-5 text-gray-400"})}),r>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full text-[10px] flex items-center justify-center text-white font-bold animate-bounce",children:r})]}),e.jsxs("div",{className:"flex-1 text-right min-w-0",children:[e.jsx("h4",{className:`text-sm font-bold truncate ${(a==null?void 0:a.id)===t.id?"text-white":"text-gray-300"}`,children:t.name}),s&&e.jsxs("p",{className:"text-[10px] text-gray-500 truncate mt-1",children:[s.senderId===(l==null?void 0:l.id)?"Ø£Ù†Øª: ":"",s.content]})]})]},t.id)})})]}),e.jsxs("div",{className:"flex-1 flex flex-col bg-black/20 relative",children:[e.jsxs("div",{className:"p-4 border-b border-white/5 bg-white/5 flex items-center justify-between shadow-sm z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[o&&e.jsx("button",{onClick:()=>b(!0),className:"md:hidden p-2 rounded-lg bg-white/5 text-gray-300",children:e.jsx(U,{className:"w-5 h-5"})}),a?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-violet-500/20 flex items-center justify-center border border-violet-500/30",children:a.avatar?e.jsx("img",{src:a.avatar,className:"w-full h-full rounded-full object-cover"}):o?e.jsx(y,{className:"w-5 h-5 text-violet-300"}):e.jsx("div",{className:"text-xl",children:"ðŸŽ“"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white",children:a.name}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),e.jsx("span",{className:"text-[10px] text-emerald-400",children:"Ù†Ø´Ø· Ø§Ù„Ø¢Ù†"})]})]})]}):e.jsx("h3",{className:"font-bold text-gray-400",children:"Ø§Ø®ØªØ± Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù„Ø¨Ø¯Ø¡"})]}),e.jsx("button",{onClick:j,className:"p-2 text-gray-400 hover:text-white transition-colors",title:"ØªØ­Ø¯ÙŠØ«",children:e.jsx(X,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-4 bg-gradient-to-b from-transparent to-black/20",children:[!a&&o?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 opacity-50",children:[e.jsx("div",{className:"w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mb-4",children:e.jsx(y,{className:"w-8 h-8"})}),e.jsx("p",{children:"Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©"})]}):T().length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 opacity-50",children:e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø³Ø§Ø¨Ù‚Ø©. Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¢Ù†!"})}):T().map((t,r)=>{const s=t.senderId===(l==null?void 0:l.id);return e.jsx("div",{className:`flex ${s?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`
                                 max-w-[75%] p-4 rounded-2xl relative group transition-all
                                 ${s?"bg-violet-600 text-white rounded-tl-sm":"bg-white/10 text-gray-200 rounded-tr-sm"}
                             `,children:[e.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:t.content}),e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-[10px] ${s?"text-violet-200":"text-gray-500"}`,children:[e.jsx("span",{children:new Date(t.timestamp).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})}),s&&(t.read?e.jsx(Y,{className:"w-3 h-3"}):e.jsx(H,{className:"w-3 h-3"}))]})]})},t.id||r)}),e.jsx("div",{ref:C})]}),(a||!o)&&e.jsx("div",{className:"p-4 bg-black/40 border-t border-white/5 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"text",value:m,onChange:t=>I(t.target.value),onKeyDown:t=>t.key==="Enter"&&R(),placeholder:"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...",className:"flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-violet-500/50 transition-all font-sans",disabled:p}),e.jsx("button",{onClick:R,disabled:!m.trim()||p,className:"p-3 bg-violet-600 hover:bg-violet-500 disabled:bg-gray-700 disabled:cursor-not-allowed text-white rounded-xl transition-all shadow-lg shadow-violet-600/20",children:p?e.jsx(A,{className:"w-5 h-5 animate-spin"}):e.jsx(J,{className:"w-5 h-5"})})]})})]})]})};export{ie as default};
