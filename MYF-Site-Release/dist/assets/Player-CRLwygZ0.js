import{c as h,u as X,a as Y,r as a,j as e,H as Z,C as _,b as u}from"./index-C1vUyfCQ.js";import ee from"./Quiz-BSkBFxZD.js";import{A as te}from"./arrow-right-DViUf_h5.js";import{P as Q}from"./play-jUqxeKBo.js";import{F as se}from"./file-text-BzhZn22v.js";import{L as re}from"./lock-Bd2pICqi.js";import"./circle-check-Bi5EwR6H.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],le=h("maximize",ae);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],A=h("minimize",ie);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],oe=h("pause",ne);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],de=h("skip-back",ce);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],he=h("skip-forward",ue);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],me=h("volume-2",xe),ze=({course:l,onBack:R})=>{const{t:U}=X(),{user:p,updateUser:fe}=Y(),[c,x]=a.useState(!1),[j,z]=a.useState(l.progress||0),[y,C]=a.useState(0),[q,B]=a.useState(0),r=a.useRef(null),M=a.useRef(null),[pe,S]=a.useState(l.progress===100),[o,N]=a.useState(0),[g,H]=a.useState(!1),[E,V]=a.useState([]),[v,$]=a.useState(null),[b,I]=a.useState([]),[ge,D]=a.useState(!0),[k,F]=a.useState(!1),m=l.episodes&&l.episodes.length>0?l.episodes:[{id:"default",title:l.title,videoUrl:l.videoUrl||"",orderIndex:0}],w=m[o],P=w.videoUrl||"https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4";a.useEffect(()=>{(async()=>{try{const s=await u.getQuizzes();V(s.filter(n=>n.courseId===l.id));const d=(await u.quizResults.get()).filter(n=>{var f;return n.percentage>=(((f=s.find(W=>W.id===n.quizId))==null?void 0:f.passingScore)||70)}).map(n=>n.quizId);if(I(d),p){const n=await u.getFavorites(p.id);F(n.some(f=>String(f.targetId)===String(l.id)&&f.type==="course"))}}catch(s){console.error("Error loading player data:",s)}finally{D(!1)}})()},[l.id]),a.useEffect(()=>{r.current&&(c?r.current.play():r.current.pause())},[c]),a.useEffect(()=>{const t=()=>{H(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",t),()=>document.removeEventListener("fullscreenchange",t)},[]);const T=()=>{var t;document.fullscreenElement?document.exitFullscreen():(t=M.current)==null||t.requestFullscreen()},G=()=>{if(r.current){const t=r.current.currentTime,s=r.current.duration;B(t),C(s||0);const i=Math.floor(t/s*100);z(i)}},J=async()=>{w.id!=="default"&&await u.updateEpisodeProgress(l.id,w.id,!0);const t=E.find(s=>s.afterEpisodeIndex===o+1);if(t&&!b.includes(t.id)){$(t);return}o===m.length-1?(u.updateCourseProgress(l.id,100),S(!0)):N(s=>s+1)},K=async()=>{if(p)try{const t=await u.toggleFavorite(p.id,l.id,"course");t&&F(t.action==="added")}catch(t){console.error("Error toggling favorite:",t)}},O=t=>t===0?!1:t>o,L=t=>{if(!t)return"00:00";const s=Math.floor(t/60),i=Math.floor(t%60);return`${s}:${i<10?"0":""}${i}`};return e.jsxs("div",{className:"flex flex-col h-full animate-fade-in pb-10",children:[e.jsxs("button",{onClick:R,className:"flex items-center gap-2 text-gray-400 hover:text-white mb-6 w-fit transition-colors",children:[e.jsx(te,{className:"w-5 h-5"}),e.jsx("span",{children:U("player.backToCourses")})]}),v?e.jsx("div",{className:"flex-1",children:e.jsx(ee,{quiz:v,onSuccess:()=>{I(t=>[...t,v.id])},onClose:()=>{b.includes(v.id)&&(o<m.length-1?N(t=>t+1):S(!0)),$(null)}})}):e.jsxs("div",{className:"flex-1 flex flex-col-reverse md:flex-row gap-8 items-center justify-center",children:[e.jsxs("div",{className:"w-full md:w-96 flex flex-col gap-4 h-full max-h-[85vh]",children:[e.jsxs("div",{className:"w-full bg-black/20 backdrop-blur-lg p-4 rounded-2xl border border-white/10 shadow-xl flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-bold text-white mb-1 truncate leading-tight",children:w.title}),e.jsx("button",{onClick:K,className:`p-1 rounded-lg transition-colors ${k?"text-red-500 hover:text-red-400":"text-gray-400 hover:text-white"}`,title:k?"إزالة من المفضلة":"إضافة للمفضلة",children:e.jsx(Z,{className:`w-4 h-4 ${k?"fill-current":""}`})})]}),e.jsx("p",{className:"text-violet-400 text-xs font-medium truncate",children:l.instructor})]}),e.jsxs("button",{onClick:J,className:"px-3 py-1.5 rounded-lg bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white text-xs font-bold transition-all shadow-lg flex-shrink-0 flex items-center gap-1",children:[e.jsx(_,{className:"w-3.5 h-3.5"}),o===m.length-1?"إكمال":"التالي"]})]}),e.jsxs("div",{className:"space-y-1 group",dir:"ltr",children:[e.jsx("input",{type:"range",value:j,onChange:t=>{const s=Number(t.target.value);z(s),r.current&&y&&(r.current.currentTime=s/100*y)},style:{background:`linear-gradient(to right, #8b5cf6 ${j}%, rgba(255,255,255,0.1) ${j}%)`},className:"w-full h-1 rounded-lg appearance-none cursor-pointer hover:h-1.5 transition-all"}),e.jsxs("div",{className:"flex justify-between text-[9px] text-gray-400 font-mono",children:[e.jsx("span",{children:L(q)}),e.jsx("span",{children:L(y)})]})]}),e.jsxs("div",{className:"flex items-center justify-between",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>{var t,s;c?(t=r.current)==null||t.pause():(s=r.current)==null||s.play(),x(!c)},className:"w-10 h-10 rounded-full bg-violet-600 hover:bg-violet-500 text-white flex items-center justify-center shadow-lg transition-all hover:scale-105",children:c?e.jsx(oe,{className:"w-4 h-4 fill-current"}):e.jsx(Q,{className:"w-4 h-4 fill-current pl-0.5"})}),e.jsxs("div",{className:"flex items-center gap-2 group",children:[e.jsx("button",{onClick:()=>{r.current&&(r.current.muted=!r.current.muted)},className:"p-1.5 rounded-full hover:bg-white/10 text-gray-300 hover:text-white transition-colors",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",defaultValue:"1",dir:"ltr",onChange:t=>{r.current&&(r.current.volume=Number(t.target.value))},className:"w-16 h-1 bg-white/10 rounded-lg accent-gray-400 hover:accent-white hidden sm:block"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{r.current&&(r.current.currentTime+=10)},className:"p-1.5 rounded-full hover:bg-white/10 text-gray-300 hover:text-white transition-colors",title:"+10s",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{r.current&&(r.current.currentTime-=10)},className:"p-1.5 rounded-full hover:bg-white/10 text-gray-300 hover:text-white transition-colors",title:"-10s",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("button",{onClick:T,className:"p-1.5 rounded-full hover:bg-white/10 text-gray-300 hover:text-white transition-colors",children:g?e.jsx(A,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 glass-panel border border-white/5 rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-white/5 bg-white/[0.02]",children:e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2 text-sm",children:[e.jsx(se,{className:"w-4 h-4 text-violet-400"}),"منهج الدورة"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2",children:m.map((t,s)=>{const i=O(s),d=s===o;return e.jsxs("button",{disabled:i,onClick:()=>N(s),className:`w-full text-right p-2.5 rounded-xl transition-all flex items-start gap-3 group relative ${d?"bg-violet-600/20 border border-violet-500/30":i?"opacity-50 grayscale cursor-not-allowed":"hover:bg-white/5 border border-transparent"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded flex items-center justify-center flex-shrink-0 mt-0.5 ${d?"bg-violet-500 text-white":"bg-black/40 text-gray-400"}`,children:e.jsx("span",{className:"text-[9px] font-bold",children:s+1})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-xs font-medium truncate ${d?"text-white":"text-gray-400"}`,children:t.title}),t.duration&&e.jsx("p",{className:"text-[9px] text-gray-500 mt-0.5",children:t.duration})]}),i?e.jsx(re,{className:"w-3 h-3 text-gray-600 mt-1"}):d?e.jsx("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 w-1.5 h-1.5 rounded-full bg-violet-500 animate-pulse"}):null]},t.id)})}),e.jsx("div",{className:"border-t border-white/5 max-h-32 overflow-y-auto",children:E.map(t=>e.jsxs("div",{className:`p-3 border-b border-white/5 last:border-0 ${b.includes(t.id)?"bg-emerald-600/10":"bg-amber-600/10"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 text-[10px] font-bold mb-0.5 ${b.includes(t.id)?"text-emerald-300":"text-amber-300"}`,children:[e.jsx(_,{className:"w-3 h-3"}),t.title]}),e.jsxs("p",{className:"text-[8px] text-gray-500",children:["بعد محاضرة ",t.afterEpisodeIndex]})]},t.id))})]})]}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center h-full",children:e.jsxs("div",{ref:M,className:`relative group transition-all rounded-2xl overflow-hidden shadow-2xl ${g?"fixed inset-0 z-50 rounded-none w-full h-full bg-black flex items-center justify-center":"w-fit h-fit max-h-[75vh] mx-auto"}`,children:[e.jsx("video",{ref:r,src:P,controlsList:"nodownload",onContextMenu:t=>t.preventDefault(),className:`block ${g?"max-w-full max-h-full":"max-h-[75vh] w-auto"} object-contain`,onPlay:()=>x(!0),onPause:()=>x(!1),onTimeUpdate:G,onEnded:()=>{x(!1)},onLoadedMetadata:()=>{var t;return C(((t=r.current)==null?void 0:t.duration)||0)}},P),!c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 hover:bg-black/30 transition-colors cursor-pointer",onClick:()=>x(!0),children:e.jsx("div",{className:"w-20 h-20 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center shadow-lg border border-white/20 group-hover:scale-110 transition-transform",children:e.jsx(Q,{className:"w-10 h-10 text-white fill-current"})})}),g&&e.jsx("div",{className:"absolute top-6 left-6 z-50 animate-fade-in",children:e.jsxs("button",{onClick:T,className:"bg-black/40 hover:bg-black/60 backdrop-blur-md text-white px-4 py-2 rounded-xl flex items-center gap-2 transition-all border border-white/10 shadow-lg group-hover:opacity-100 opacity-0 transition-opacity duration-3000 delay-1000",style:{opacity:1},children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-bold",children:"تصغير الشاشة"})]})})]})})]})]})};export{ze as default};
