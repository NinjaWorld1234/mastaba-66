import{u as V,b as L,r as n,j as e,m as I}from"./index-BCSIu09u.js";import{C as P}from"./circle-check-Y1hDx6Au.js";import{M as A}from"./mail-v8DhZ2G7.js";import{L as N}from"./loader-circle-CMMFDUc1.js";const F=({email:f,onSuccess:v,onBack:S})=>{const{language:a}=V(),{login:J}=L(),[u,d]=n.useState(["","","","","",""]),[h,p]=n.useState(!1),[x,g]=n.useState(!1),[j,c]=n.useState(""),[C,E]=n.useState(!1),[i,b]=n.useState(60),[m,w]=n.useState(!1),l=n.useRef([]);n.useEffect(()=>{if(i>0&&!m){const r=setTimeout(()=>b(i-1),1e3);return()=>clearTimeout(r)}else i===0&&w(!0)},[i,m]);const R=(r,s)=>{var o;if(!/^\d*$/.test(s))return;const t=[...u];t[r]=s.slice(-1),d(t),c(""),s&&r<5&&((o=l.current[r+1])==null||o.focus()),t.every(D=>D)&&t.join("").length===6&&y(t.join(""))},k=(r,s)=>{var t;s.key==="Backspace"&&!u[r]&&r>0&&((t=l.current[r-1])==null||t.focus())},O=r=>{r.preventDefault();const s=r.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(s.length===6){const t=s.split("");d(t),y(s)}},y=async r=>{var s;p(!0),c("");try{const t=await fetch("/api/verify-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:f,otp:r})}),o=await t.json();if(!t.ok)throw new Error(a==="ar"&&o.errorAr||o.error);localStorage.setItem("authToken",o.accessToken),localStorage.setItem("user",JSON.stringify(o.user)),localStorage.removeItem("pendingVerificationEmail"),E(!0),setTimeout(()=>{v()},1500)}catch(t){c(t instanceof Error?t.message:"Verification failed"),d(["","","","","",""]),(s=l.current[0])==null||s.focus()}finally{p(!1)}},T=async()=>{var r;if(!(!m||x)){g(!0),c("");try{const s=await fetch("/api/resend-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:f})}),t=await s.json();if(!s.ok)throw new Error(a==="ar"&&t.errorAr||t.error);b(60),w(!1),d(["","","","","",""]),(r=l.current[0])==null||r.focus()}catch(s){c(s instanceof Error?s.message:"Failed to resend code")}finally{g(!1)}}};return C?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-panel w-full max-w-md p-8 rounded-[2.5rem] text-center animate-fade-in border border-white/20 shadow-2xl",children:[e.jsx("div",{className:"w-20 h-20 bg-emerald-600/20 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce",children:e.jsx(P,{className:"w-10 h-10 text-emerald-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:a==="ar"?"تم التحقق بنجاح!":"Verification Successful!"}),e.jsx("p",{className:"text-gray-400",children:a==="ar"?"جاري تحويلك إلى لوحة التحكم...":"Redirecting to dashboard..."})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-panel w-full max-w-md p-8 rounded-[2.5rem] relative overflow-hidden animate-fade-in border border-white/20 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-600/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(A,{className:"w-8 h-8 text-emerald-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:a==="ar"?"تحقق من بريدك":"Verify Your Email"}),e.jsx("p",{className:"text-gray-400 text-sm",children:a==="ar"?"أرسلنا رمز تحقق مكون من 6 أرقام إلى":"We sent a 6-digit verification code to"}),e.jsx("p",{className:"text-emerald-400 font-medium mt-1",children:f})]}),j&&e.jsx("div",{className:"bg-red-500/20 border border-red-500/50 rounded-xl p-3 mb-4 text-red-300 text-sm text-center",children:j}),e.jsx("div",{className:"flex justify-center gap-2 mb-6",dir:"ltr",children:u.map((r,s)=>e.jsx("input",{ref:t=>l.current[s]=t,type:"text",inputMode:"numeric",maxLength:1,value:r,onChange:t=>R(s,t.target.value),onKeyDown:t=>k(s,t),onPaste:O,disabled:h,className:"w-12 h-14 text-center text-2xl font-bold bg-black/30 border border-white/10 rounded-xl text-white focus:outline-none focus:border-emerald-500 transition-colors disabled:opacity-50"},s))}),h&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-emerald-400 mb-4",children:[e.jsx(N,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:a==="ar"?"جاري التحقق...":"Verifying..."})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:a==="ar"?"لم تستلم الرمز؟":"Didn't receive the code?"}),m?e.jsxs("button",{onClick:T,disabled:x,className:"text-emerald-400 hover:text-emerald-300 font-medium flex items-center justify-center gap-2 mx-auto transition-colors disabled:opacity-50",children:[x?e.jsx(N,{className:"w-4 h-4 animate-spin"}):e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:a==="ar"?"إعادة الإرسال":"Resend Code"})]}):e.jsx("p",{className:"text-gray-500 text-sm",children:a==="ar"?`إعادة الإرسال خلال ${i} ثانية`:`Resend in ${i} seconds`})]}),e.jsx("button",{onClick:S,className:"w-full mt-6 py-3 rounded-xl bg-gray-700 hover:bg-gray-600 text-white font-medium transition-colors",children:a==="ar"?"تغيير البريد الإلكتروني":"Change Email"})]})})};export{F as default};
