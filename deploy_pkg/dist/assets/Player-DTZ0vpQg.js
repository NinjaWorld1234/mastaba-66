import{u as I,b as R,r,j as e,a as b}from"./index-CEBuFF1J.js";import{A as U}from"./arrow-right-BuK3eZ8K.js";import{F}from"./file-text-DpDxPUB6.js";import{L as M}from"./lock-rfZM38VG.js";import{C as B}from"./circle-check-big-DEbq-W9B.js";import{P as A}from"./play-tDSqt2t_.js";const V=({course:l,onBack:j})=>{const{t:w}=I(),{user:z,updateUser:D}=R(),[x,m]=r.useState(!1),[N,f]=r.useState(l.progress||0),[u,h]=r.useState(0),[y,k]=r.useState(0),a=r.useRef(null),C=r.useRef(null),[q,E]=r.useState(l.progress===100),[o,p]=r.useState(0),[P,T]=r.useState(!1),i=l.episodes&&l.episodes.length>0?l.episodes:[{id:"default",title:l.title,videoUrl:l.videoUrl||"",orderIndex:0}],c=i[o],g=c.videoUrl||"https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4";r.useEffect(()=>{a.current&&(x?a.current.play():a.current.pause())},[x]),r.useEffect(()=>{const t=()=>{T(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",t),()=>document.removeEventListener("fullscreenchange",t)},[]);const S=()=>{if(a.current){const t=a.current.currentTime,s=a.current.duration;k(t),h(s||0);const n=Math.floor(t/s*100);f(n)}},L=async()=>{c.id!=="default"&&await b.updateEpisodeProgress(l.id,c.id,!0),o===i.length-1?(b.updateCourseProgress(l.id,100),E(!0)):p(t=>t+1)},$=t=>t===0?!1:t>o,v=t=>{if(!t)return"00:00";const s=Math.floor(t/60),n=Math.floor(t%60);return`${s}:${n<10?"0":""}${n}`};return e.jsxs("div",{className:"flex flex-col h-full animate-fade-in pb-10",children:[e.jsxs("button",{onClick:j,className:"flex items-center gap-2 text-gray-400 hover:text-white mb-6 w-fit transition-colors",children:[e.jsx(U,{className:"w-5 h-5"}),e.jsx("span",{children:w("player.backToCourses")})]}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row gap-8 items-center justify-center",children:[e.jsxs("div",{className:"w-full md:w-80 flex flex-col h-full max-h-[70vh] glass-panel border border-white/5 rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-white/5 bg-white/[0.02]",children:e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-violet-400"}),"منهج الدورة"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2",children:i.map((t,s)=>{const n=$(s),d=s===o;return e.jsxs("button",{disabled:n,onClick:()=>p(s),className:`w-full text-right p-3 rounded-xl transition-all flex items-start gap-3 group relative ${d?"bg-violet-600/20 border border-violet-500/30":n?"opacity-50 grayscale cursor-not-allowed":"hover:bg-white/5 border border-transparent"}`,children:[e.jsx("div",{className:`w-6 h-6 rounded flex items-center justify-center flex-shrink-0 mt-0.5 ${d?"bg-violet-500 text-white":"bg-black/40 text-gray-400"}`,children:e.jsx("span",{className:"text-[10px] font-bold",children:s+1})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-xs font-medium truncate ${d?"text-white":"text-gray-400"}`,children:t.title}),t.duration&&e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:t.duration})]}),n?e.jsx(M,{className:"w-3.5 h-3.5 text-gray-600 mt-1"}):d?e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-1.5 h-1.5 rounded-full bg-violet-500 animate-pulse"}):null]},t.id)})}),o>0&&(o+1)%3===0&&e.jsxs("div",{className:"p-4 bg-violet-600/10 border-t border-violet-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-violet-300 text-xs font-bold mb-2",children:[e.jsx(B,{className:"w-4 h-4"}),"حان وقت الاختبار!"]}),e.jsx("p",{className:"text-[10px] text-gray-400 mb-3 leading-relaxed",children:"اكمل هذه المحاضرة لفتح الاختبار للمرحلة القادمة."})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-6",children:[e.jsxs("div",{ref:C,className:`w-full rounded-2xl overflow-hidden shadow-2xl border border-white/10 relative group bg-black transition-all ${P?"fixed inset-0 z-50 rounded-none":""}`,children:[e.jsx("video",{ref:a,src:g,className:"w-full max-h-[60vh] object-contain",onTimeUpdate:S,onEnded:()=>{m(!1)},onLoadedMetadata:()=>{var t;return h(((t=a.current)==null?void 0:t.duration)||0)}},g),!x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 cursor-pointer",onClick:()=>m(!0),children:e.jsx(A,{className:"w-16 h-16 text-white opacity-80"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:c.title}),e.jsx("p",{className:"text-violet-400 text-sm",children:l.instructor})]}),e.jsx("button",{onClick:L,className:"px-6 py-2.5 rounded-xl bg-violet-600 text-white text-sm font-bold hover:bg-violet-500 transition-all shadow-lg shadow-violet-600/20",children:o===i.length-1?"إكمال الدورة":"المحاضرة التالية"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"range",value:N,onChange:t=>{const s=Number(t.target.value);f(s),a.current&&u&&(a.current.currentTime=s/100*u)},className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-violet-500"}),e.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500 font-mono",children:[e.jsx("span",{children:v(y)}),e.jsx("span",{children:v(u)})]})]})]})]})]})]})};export{V as default};
