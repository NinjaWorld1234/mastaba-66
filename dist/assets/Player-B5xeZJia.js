import{c as v,u as de,a as ue,r as i,j as e,H as xe,C as O,d as he,b}from"./index-6ITzeY_0.js";import me from"./Quiz-Ci2LaKFk.js";import{A as fe}from"./arrow-right-D9K4dX4m.js";import{L as y}from"./lock-Bn-Pk5ij.js";import{P as X}from"./play-CNTZQ_Gn.js";import{F as pe}from"./file-text-oU2HIO4W.js";import"./circle-check-wDMROSP5.js";import"./eye-DMOUvmn1.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],be=v("maximize",ge);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],Y=v("minimize",ve);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],ye=v("pause",we);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],Ne=v("skip-back",je);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],ze=v("skip-forward",ke);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Ce=v("volume-2",Ee),Re=({course:c,onBack:Z})=>{const{t:ee}=de(),{user:s,updateUser:Se}=ue(),[u,m]=i.useState(!1),[f,C]=i.useState(c.progress||0),[S,F]=i.useState(0),[M,te]=i.useState(0),n=i.useRef(null),q=i.useRef(null),[p,R]=i.useState(c.progress===100),[x,I]=i.useState(0),[j,se]=i.useState(!1),[N,re]=i.useState([]),[k,$]=i.useState(null),[L,_]=i.useState([]),[Me,ae]=i.useState(!0),[P,Q]=i.useState(!1),[T,ie]=i.useState(1),[z,V]=i.useState(0),[ne,A]=i.useState(!1),[D,w]=i.useState(!0),[U,B]=i.useState(!1),h=c.episodes&&c.episodes.length>0?c.episodes:[{id:"default",title:c.title,videoUrl:c.videoUrl||"",orderIndex:0}],E=h[x],H=E.videoUrl||"https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",le=i.useMemo(()=>{const t=[];return N.filter(r=>r.afterEpisodeIndex===0).forEach(r=>{t.push({type:"quiz",data:r})}),h.forEach((r,a)=>{t.push({type:"episode",data:r,index:a}),N.filter(l=>l.afterEpisodeIndex===a+1).forEach(l=>{t.push({type:"quiz",data:l})})}),t},[h,N]);i.useEffect(()=>{(async()=>{try{const r=await b.getQuizzes();re(r.filter(o=>o.courseId===c.id));const l=(await b.quizResults.get()).filter(o=>{var d;return o.percentage>=(((d=r.find(g=>g.id===o.quizId))==null?void 0:d.passingScore)||70)}).map(o=>o.quizId);if(_(l),s){const o=await b.getFavorites(s.id);Q(o.some(d=>String(d.targetId)===String(c.id)&&d.type==="course"))}}catch(r){console.error("Error loading player data:",r)}finally{ae(!1)}})()},[c.id]),i.useEffect(()=>{n.current&&(u?n.current.play():n.current.pause())},[u]),i.useEffect(()=>{const t=()=>{se(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",t),()=>document.removeEventListener("fullscreenchange",t)},[]);const K=()=>{var t;document.fullscreenElement?document.exitFullscreen():(t=q.current)==null||t.requestFullscreen()},oe=()=>{if(n.current){const t=n.current.currentTime,r=n.current.duration;te(t),F(r||0),t>z&&V(t);const a=Math.floor(t/r*100);C(a)}};i.useEffect(()=>{const t=()=>{document.hidden&&u&&(s==null?void 0:s.role)!=="admin"&&(m(!1),A(!0))},r=a=>{a.key==="PrintScreen"&&(s==null?void 0:s.role)!=="admin"&&(A(!0),a.preventDefault())};return document.addEventListener("visibilitychange",t),document.addEventListener("keydown",r),()=>{document.removeEventListener("visibilitychange",t),document.removeEventListener("keydown",r)}},[u]),i.useEffect(()=>{n.current&&(n.current.playbackRate=T)},[T]);const W=async()=>{E.id!=="default"&&await b.updateEpisodeProgress(c.id,E.id,!0);let t=N.find(r=>r.afterEpisodeIndex===x+1);if(t&&L.includes(t.id)&&(t=void 0),t&&(s==null?void 0:s.role)!=="admin"){$(t);return}x===h.length-1?(b.updateCourseProgress(c.id,100),R(!0)):(I(r=>r+1),V(0),C(0))},ce=async()=>{if(s)try{const t=await b.toggleFavorite(s.id,c.id,"course");t&&Q(t.action==="added")}catch(t){console.error("Error toggling favorite:",t)}},G=t=>(s==null?void 0:s.role)==="admin"||t===0?!1:(h[t-1].completed||t-1<x,t>x),J=t=>{if(!t)return"00:00";const r=Math.floor(t/60),a=Math.floor(t%60);return`${r}:${a<10?"0":""}${a}`};return e.jsxs("div",{className:"flex flex-col h-full animate-fade-in pb-10",children:[e.jsxs("button",{onClick:Z,className:"flex items-center gap-2 text-gray-400 hover:text-white mb-6 w-fit transition-colors",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{children:ee("player.backToCourses")})]}),k?e.jsx("div",{className:"flex-1",children:e.jsx(me,{quiz:k,onSuccess:()=>{_(t=>[...t,k.id])},onClose:()=>{L.includes(k.id)&&(x<h.length-1?I(t=>t+1):R(!0)),$(null)}})}):e.jsxs("div",{className:"flex-1 flex flex-col-reverse md:flex-row gap-8 items-center justify-center",children:[e.jsxs("div",{className:"w-full md:w-96 flex flex-col gap-4 h-full max-h-[85vh]",children:[e.jsxs("div",{className:"w-full bg-black/20 backdrop-blur-lg p-4 rounded-2xl border border-white/10 shadow-xl flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-bold text-white mb-1 truncate leading-tight",children:E.title}),e.jsx("button",{onClick:ce,className:`p-1 rounded-lg transition-colors ${P?"text-red-500 hover:text-red-400":"text-gray-400 hover:text-white"}`,title:P?"إزالة من المفضلة":"إضافة للمفضلة",children:e.jsx(xe,{className:`w-4 h-4 ${P?"fill-current":""}`})})]}),e.jsx("p",{className:"text-violet-400 text-xs font-medium truncate",children:c.instructor})]}),e.jsxs("button",{onClick:W,disabled:(s==null?void 0:s.role)!=="admin"&&f<100&&!p,className:`px-3 py-1.5 rounded-lg text-white text-xs font-bold transition-all shadow-lg flex-shrink-0 flex items-center gap-1 ${(s==null?void 0:s.role)!=="admin"&&f<100&&!p?"bg-gray-600 cursor-not-allowed opacity-50":"bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500"}`,children:[(s==null?void 0:s.role)!=="admin"&&f<100&&!p?e.jsx(y,{className:"w-3 h-3"}):e.jsx(O,{className:"w-3.5 h-3.5"}),x===h.length-1?"إكمال":"التالي"]})]}),e.jsxs("div",{className:"space-y-1 group",dir:"ltr",children:[e.jsx("input",{type:"range",value:f,onChange:t=>{const r=Number(t.target.value),a=r/100*S;(s==null?void 0:s.role)==="admin"||a<=z||p||a<M?(C(r),n.current&&S&&(n.current.currentTime=a)):console.warn("Seeking forward is restricted until content is watched.")},style:{background:`linear-gradient(to right, #8b5cf6 ${f}%, rgba(255,255,255,0.1) ${f}%)`},className:"w-full h-1 rounded-lg appearance-none cursor-pointer hover:h-1.5 transition-all"}),e.jsxs("div",{className:"flex justify-between text-[9px] text-gray-400 font-mono",children:[e.jsx("span",{children:J(M)}),e.jsx("span",{children:J(S)})]})]}),e.jsxs("div",{className:"flex items-center justify-between",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>{var t,r;u?(t=n.current)==null||t.pause():(r=n.current)==null||r.play(),m(!u)},className:"w-10 h-10 rounded-full bg-violet-600 hover:bg-violet-500 text-white flex items-center justify-center shadow-lg transition-all hover:scale-105",children:u?e.jsx(ye,{className:"w-4 h-4 fill-current"}):e.jsx(X,{className:"w-4 h-4 fill-current pl-0.5"})}),e.jsxs("div",{className:"flex items-center gap-2 group",children:[e.jsx("button",{onClick:()=>{n.current&&(n.current.muted=!n.current.muted)},className:"p-1.5 rounded-full hover:bg-white/10 text-gray-300 hover:text-white transition-colors",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",defaultValue:"1",dir:"ltr",onChange:t=>{n.current&&(n.current.volume=Number(t.target.value))},className:"w-16 h-1 bg-white/10 rounded-lg accent-gray-400 hover:accent-white hidden sm:block"})]}),e.jsxs("select",{value:T,onChange:t=>ie(Number(t.target.value)),className:"bg-black/40 border border-white/10 rounded-lg px-2 py-1 text-[10px] text-gray-300 focus:outline-none focus:border-violet-500",dir:"ltr",children:[e.jsx("option",{value:"0.25",children:"0.25x"}),e.jsx("option",{value:"0.5",children:"0.5x"}),e.jsx("option",{value:"0.75",children:"0.75x"}),e.jsx("option",{value:"1",children:"1.0x"}),e.jsx("option",{value:"1.25",children:"1.25x"}),e.jsx("option",{value:"1.5",children:"1.5x"}),e.jsx("option",{value:"2",children:"2.0x"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{if(n.current){const t=n.current.currentTime+10;(s==null?void 0:s.role)==="admin"||t<=z||p?n.current.currentTime=t:console.warn("Cannot skip forward beyond watched content.")}},className:`p-1.5 rounded-full transition-colors ${(s==null?void 0:s.role)==="admin"||M+10<=z||p?"hover:bg-white/10 text-gray-300 hover:text-white":"text-gray-600 cursor-not-allowed"}`,title:"+10s",children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{n.current&&(n.current.currentTime-=10)},className:"p-1.5 rounded-full hover:bg-white/10 text-gray-300 hover:text-white transition-colors",title:"-10s",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:K,className:"p-1.5 rounded-full hover:bg-white/10 text-gray-300 hover:text-white transition-colors",children:j?e.jsx(Y,{className:"w-4 h-4"}):e.jsx(be,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 glass-panel border border-white/5 rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-white/5 bg-white/[0.02]",children:e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2 text-sm",children:[e.jsx(pe,{className:"w-4 h-4 text-violet-400"}),"منهج الدورة"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2",children:le.map((t,r)=>{if(t.type==="episode"){const a=t.data,l=t.index,o=G(l),d=l===x;return e.jsxs("button",{disabled:o,onClick:()=>I(l),className:`w-full text-right p-2.5 rounded-xl transition-all flex items-start gap-3 group relative ${d?"bg-violet-600/20 border border-violet-500/30":o?"opacity-50 grayscale cursor-not-allowed":"hover:bg-white/5 border border-transparent"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded flex items-center justify-center flex-shrink-0 mt-0.5 ${d?"bg-violet-500 text-white":"bg-black/40 text-gray-400"}`,children:e.jsx("span",{className:"text-[9px] font-bold",children:l+1})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-xs font-medium truncate ${d?"text-white":"text-gray-400"}`,children:a.title}),a.duration&&e.jsx("p",{className:"text-[9px] text-gray-500 mt-0.5",children:a.duration})]}),o?e.jsx(y,{className:"w-3 h-3 text-gray-600 mt-1"}):d?e.jsx("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 w-1.5 h-1.5 rounded-full bg-violet-500 animate-pulse"}):null]},`ep-${a.id}`)}else{const a=t.data,l=L.includes(a.id),o=a.afterEpisodeIndex||0,d=(s==null?void 0:s.role)==="admin",g=!d&&o>0&&G(o);return e.jsxs("div",{onClick:()=>{(d||!g&&!l)&&$(a)},className:`w-full text-right p-3 rounded-xl transition-all flex items-start gap-3 border ${l?"bg-emerald-600/10 border-emerald-500/30 text-emerald-300":g?"bg-white/5 border-transparent opacity-50 grayscale cursor-not-allowed":"bg-amber-600/10 border-amber-500/30 text-amber-300 hover:bg-amber-600/20 cursor-pointer"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded flex items-center justify-center flex-shrink-0 mt-0.5 ${l?"bg-emerald-500 text-white":"bg-amber-500 text-white"}`,children:e.jsx(he,{className:"w-3 h-3"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-bold truncate",children:a.title}),e.jsx("p",{className:"text-[9px] opacity-70 mt-0.5",children:l?"تم الاجتياز بنجاح":g?"مغلق حتى إكمال المحاضرة":"اختبار متاح - اضغط للبدء"})]}),l&&e.jsx(O,{className:"w-3.5 h-3.5 text-emerald-400 mt-1"}),g&&e.jsx(y,{className:"w-3 h-3 text-gray-600 mt-1"})]},`quiz-${a.id}`)}})})]})]}),e.jsx("div",{className:"flex-1 w-full flex flex-col items-center justify-center p-2 min-h-[400px]",children:e.jsxs("div",{ref:q,className:`relative group transition-all rounded-2xl overflow-hidden shadow-2xl bg-black ${j?"fixed inset-0 z-50 rounded-none w-full h-full flex items-center justify-center":"w-fit max-w-full mx-auto"}`,style:{height:j?"100vh":"auto"},children:[D&&!U&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-900/50 backdrop-blur-sm z-10",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-violet-500 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-white text-sm font-medium",children:"جاري تحميل المحتوى..."})]}),U&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-900 z-20 p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mb-4",children:e.jsx(y,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"عذراً، فشل تحميل الفيديو"}),e.jsx("p",{className:"text-gray-400 text-sm mb-6",children:"يرجى التحقق من اتصال الإنترنت أو المحاولة مرة أخرى لاحقاً."}),e.jsx("button",{onClick:()=>{B(!1),w(!0)},className:"px-6 py-2 bg-violet-600 hover:bg-violet-500 text-white rounded-xl font-bold transition-colors",children:"إعادة المحاولة"})]}),e.jsx("video",{ref:n,src:H,playsInline:!0,preload:"metadata",controlsList:"nodownload",onContextMenu:t=>t.preventDefault(),className:`max-h-[70vh] w-auto max-w-full mx-auto block transition-opacity duration-300 ${D?"opacity-0":"opacity-100"}`,onPlay:()=>m(!0),onPause:()=>m(!1),onTimeUpdate:oe,onWaiting:()=>w(!0),onPlaying:()=>w(!1),onCanPlay:()=>w(!1),onError:()=>{B(!0),w(!1)},onEnded:()=>{m(!1),W()},onLoadedMetadata:()=>{var t;return F(((t=n.current)==null?void 0:t.duration)||0)}},H),!u&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 hover:bg-black/30 transition-colors cursor-pointer",onClick:()=>m(!0),children:e.jsx("div",{className:"w-20 h-20 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center shadow-lg border border-white/20 group-hover:scale-110 transition-transform",children:e.jsx(X,{className:"w-10 h-10 text-white fill-current"})})}),j&&e.jsx("div",{className:"absolute top-6 left-6 z-50 animate-fade-in",children:e.jsxs("button",{onClick:K,className:"bg-black/40 hover:bg-black/60 backdrop-blur-md text-white px-4 py-2 rounded-xl flex items-center gap-2 transition-all border border-white/10 shadow-lg group-hover:opacity-100 opacity-0 transition-opacity duration-3000 delay-1000",style:{opacity:1},children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-bold",children:"تصغير الشاشة"})]})})]})})]}),ne&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/90 animate-fade-in backdrop-blur-md",children:e.jsxs("div",{className:"bg-red-600/20 border border-red-500/50 p-8 rounded-3xl max-w-md text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce",children:e.jsx(y,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-white",children:"تنبيه أمان!"}),e.jsx("p",{className:"text-red-200",children:"يُمنع تسجيل الشاشة أو مغادرة الصفحة أثناء تشغيل المحتوى. يرجى الالتزام بسياسات المنصة لحماية حقوق الملكية."}),e.jsx("button",{onClick:()=>A(!1),className:"px-6 py-2 bg-white text-red-600 font-bold rounded-xl hover:bg-red-50 transition-colors",children:"فهمت ذلك"})]})})]})};export{Re as default};
