import{d as P,r as s,j as e,X as y,c as g,m as F,g as ue,G as pe,S as be,l as ge,k as fe}from"./index-PO4O9_Fr.js";import{s as je,a as we}from"./sanitize-CRr1UQdy.js";import{u as ye}from"./usePagination-yudK0T-c.js";import{u as ve}from"./useDebounce-D8YZ8g9s.js";import{C as U}from"./check-4m4axsU5.js";import{U as Ne,S as Se}from"./StudentDetailsModal-CxLXmen9.js";import{E as ke}from"./eye-DOTsDHGN.js";import{S as Ce}from"./square-pen-9VgwtPiN.js";import{S as Me}from"./save-D0iCKTwe.js";import"./mail--37byxe_.js";import"./map-pin-B659mmqr.js";import"./phone-k7tXVEg0.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],T=P("arrow-right-left",Ie);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],S=P("shield",Oe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ae=P("user-x",Pe),De=({isOpen:t,onClose:c,onSubmit:r,student:l})=>{const[d,m]=s.useState({});s.useEffect(()=>{l&&m({name:l.name,email:l.email,phone:l.phone||"",bio:l.bio||"",status:l.status,level:l.level,points:l.points})},[l]);const x=n=>{n.preventDefault(),l&&r(l.id,d)},i=(n,u)=>{m(j=>({...j,[n]:u}))};return!t||!l?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"glass-panel w-full max-w-lg p-6 relative animate-fade-in rounded-3xl border border-white/10",children:[e.jsx("button",{onClick:c,className:"absolute left-4 top-4 text-gray-400 hover:text-white transition-colors",children:e.jsx(y,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-6 font-serif",children:"تعديل بيانات الطالب"}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"الاسم"}),e.jsx("input",{type:"text",value:d.name||"",onChange:n=>i("name",n.target.value),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500",dir:"auto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",value:d.email||"",onChange:n=>i("email",n.target.value),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"الحالة"}),e.jsxs("select",{value:d.status||"active",onChange:n=>i("status",n.target.value),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500",children:[e.jsx("option",{value:"active",className:"text-black",children:"نشط"}),e.jsx("option",{value:"inactive",className:"text-black",children:"غير نشط"}),e.jsx("option",{value:"suspended",className:"text-black",children:"موقوف"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"المستوى"}),e.jsx("input",{type:"number",value:d.level||1,onChange:n=>i("level",parseInt(n.target.value)),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"النقاط"}),e.jsx("input",{type:"number",value:d.points||0,onChange:n=>i("points",parseInt(n.target.value)),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500"})]})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:c,className:"flex-1 py-3 bg-white/5 hover:bg-white/10 rounded-xl text-gray-300 font-bold",children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex-1 py-3 bg-emerald-600 hover:bg-emerald-500 rounded-xl text-white font-bold flex items-center justify-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),e.jsx("span",{children:"حفظ التغييرات"})]})]})]})]})})},L=s.memo(({stat:t})=>e.jsx("article",{className:"glass-panel p-5 rounded-2xl","aria-label":`${t.label}: ${t.value}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-br ${t.color} flex items-center justify-center`,"aria-hidden":"true",children:e.jsx(t.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:t.label}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.value})]})]})}));L.displayName="StatCard";const _=s.memo(({student:t,supervisors:c,onDelete:r,onEdit:l,onView:d,onPromote:m,onTransfer:x,onDemote:i})=>{var w,v;const n=s.useCallback(()=>{window.confirm("هل أنت متأكد من حذف هذا الطالب؟")&&r(t.id)},[t.id,r]),u=s.useMemo(()=>{switch(t.status){case"active":return"نشط";case"inactive":return"غير نشط";default:return"معلق"}},[t.status]),j=s.useMemo(()=>{switch(t.status){case"active":return"bg-emerald-500/20 text-emerald-400";case"inactive":return"bg-red-500/20 text-red-400";default:return"bg-amber-500/20 text-amber-400"}},[t.status]);return e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.avatar,alt:`صورة ${t.name}`,className:"w-10 h-10 rounded-full bg-white/5",loading:"lazy"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:t.name}),e.jsx("p",{className:"text-gray-400 text-sm",children:t.email})]})]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(ge,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:(w=t.joinDate)==null?void 0:w.split("T")[0]})]})}),e.jsxs("td",{className:"py-4 px-6 text-white",children:["المستوى ",t.level]}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex flex-col gap-1 max-w-[200px]",children:[e.jsx("span",{className:"text-white text-sm line-clamp-1",title:t.activeCourses||"لا يوجد",children:t.activeCourses||"لا يوجد"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 rounded-full",style:{width:`${Math.min((t.completedLessons||0)*5,100)}%`}})}),e.jsxs("span",{className:"text-[10px] text-gray-400 shrink-0",children:[t.completedLessons||0," درس"]})]})]})}),e.jsx("td",{className:"py-4 px-6",children:t.role==="supervisor"?e.jsxs("div",{className:"flex items-center gap-2 text-emerald-400 font-bold bg-emerald-500/10 px-3 py-1 rounded-lg w-fit",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsxs("span",{children:["مشرف (",t.supervisorPriority,")"]})]}):e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gray-400 text-xs",children:"المشرف:"}),e.jsx("span",{className:"text-white text-sm",children:((v=c.find(N=>N.id===t.supervisorId))==null?void 0:v.name)||"الإدارة"})]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${j}`,children:u})}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>d(t.id),className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 hover:text-emerald-400 transition-colors",title:"عرض الملف",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>l(t),className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 hover:text-blue-400 transition-colors",title:"تعديل",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:n,className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 hover:text-red-400 transition-colors",title:"حذف",children:e.jsx(Ae,{className:"w-4 h-4"})}),t.role==="student"?e.jsx("button",{onClick:()=>m(t),className:"p-2 rounded-lg bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-400 transition-colors",title:"تعيين كمشرف",children:e.jsx(fe,{className:"w-4 h-4"})}):e.jsx("button",{onClick:()=>i(t.id),className:"p-2 rounded-lg bg-amber-500/10 hover:bg-amber-500/20 text-amber-400 transition-colors",title:"إلغاء الإشراف",children:e.jsx(S,{className:"w-4 h-4"})}),t.role==="student"&&e.jsx("button",{onClick:()=>x(t),className:"p-2 rounded-lg bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 transition-colors",title:"نقل لمشرف آخر",children:e.jsx(T,{className:"w-4 h-4"})})]})})]})});_.displayName="StudentRow";const q=s.memo(({isOpen:t,onClose:c,onSubmit:r})=>{const[l,d]=s.useState({name:"",email:"",password:"",role:"student"}),m=s.useCallback(i=>{i.preventDefault(),!(!l.name||!l.email||!l.password)&&(r(l),d({name:"",email:"",password:"",role:"student"}))},[l,r]),x=s.useCallback((i,n)=>{d(u=>({...u,[i]:n}))},[]);return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:"bg-[#0a1815] border border-white/10 rounded-3xl w-full max-w-lg p-6 relative animate-fade-in border-t border-emerald-500/20",children:[e.jsx("button",{onClick:c,className:"absolute left-4 top-4 text-gray-400 hover:text-white transition-colors","aria-label":"إغلاق النافذة",children:e.jsx(y,{className:"w-6 h-6","aria-hidden":"true"})}),e.jsx("h3",{id:"modal-title",className:"text-2xl font-bold text-white mb-6 font-serif",children:"إضافة طالب جديد"}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-gray-400 text-sm mb-2",children:"الاسم الكامل"}),e.jsx("input",{id:"name",type:"text",required:!0,value:l.name,onChange:i=>x("name",i.target.value),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20",placeholder:"أدخل اسم الطالب"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-gray-400 text-sm mb-2",children:"البريد الإلكتروني"}),e.jsx("input",{id:"email",type:"email",required:!0,value:l.email,onChange:i=>x("email",i.target.value),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20",placeholder:"example@domain.com"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-gray-400 text-sm mb-2",children:"كلمة المرور المؤقتة"}),e.jsx("input",{id:"password",type:"password",required:!0,value:l.password,onChange:i=>x("password",i.target.value),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20",placeholder:"******"})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:c,className:"flex-1 py-3 bg-white/5 hover:bg-white/10 rounded-xl text-gray-300 font-bold transition-colors",children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex-1 py-3 bg-emerald-600 hover:bg-emerald-500 rounded-xl text-white font-bold transition-colors flex items-center justify-center gap-2",children:[e.jsx(U,{className:"w-5 h-5","aria-hidden":"true"}),e.jsx("span",{children:"إضافة الطالب"})]})]})]})]})}):null});q.displayName="AddStudentModal";const R=s.memo(({isOpen:t,onClose:c,student:r,onSubmit:l})=>{const[d,m]=s.useState(10),[x,i]=s.useState(1);return s.useEffect(()=>{r&&(m(r.supervisorCapacity||10),i(r.supervisorPriority||1))},[r]),!t||!r?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-[#0a1815] border border-white/10 rounded-3xl w-full max-w-md p-6 relative animate-fade-in border-t border-emerald-500/20",children:[e.jsx("button",{onClick:c,className:"absolute left-4 top-4 text-gray-400 hover:text-white transition-colors",children:e.jsx(y,{className:"w-6 h-6"})}),e.jsxs("h3",{className:"text-2xl font-bold text-white mb-6 font-serif",children:["تعيين كمشرف: ",r.name]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"سعة الطلاب القصوى"}),e.jsx("input",{type:"number",value:d,onChange:n=>m(parseInt(n.target.value)),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"أولوية الانضمام (1 هو الأعلى)"}),e.jsx("input",{type:"number",value:x,onChange:n=>i(parseInt(n.target.value)),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500"})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx("button",{onClick:c,className:"flex-1 py-3 bg-white/5 hover:bg-white/10 rounded-xl text-gray-300 font-bold",children:"إلغاء"}),e.jsxs("button",{onClick:()=>l(d,x),className:"flex-1 py-3 bg-emerald-600 hover:bg-emerald-500 rounded-xl text-white font-bold flex items-center justify-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("span",{children:"تثبيت كمشرف"})]})]})]})]})})});R.displayName="PromoteSupervisorModal";const H=s.memo(({isOpen:t,onClose:c,student:r,supervisors:l,onSubmit:d})=>{const[m,x]=s.useState((r==null?void 0:r.supervisorId)||null);return!t||!r?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-[#0a1815] border border-white/10 rounded-3xl w-full max-w-md p-6 relative animate-fade-in border-t border-emerald-500/20",children:[e.jsx("button",{onClick:c,className:"absolute left-4 top-4 text-gray-400 hover:text-white transition-colors",children:e.jsx(y,{className:"w-6 h-6"})}),e.jsxs("h3",{className:"text-2xl font-bold text-white mb-6 font-serif",children:["نقل الطالب: ",r.name]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"اختر المشرف الجديد"}),e.jsxs("select",{value:m||"",onChange:i=>x(i.target.value||null),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500",children:[e.jsx("option",{value:"",children:"الإدارة مباشرة"}),l.map(i=>e.jsxs("option",{value:i.id,children:[i.name," (",i.email,")"]},i.id))]})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx("button",{onClick:c,className:"flex-1 py-3 bg-white/5 hover:bg-white/10 rounded-xl text-gray-300 font-bold",children:"إلغاء"}),e.jsxs("button",{onClick:()=>d(m),className:"flex-1 py-3 bg-blue-600 hover:bg-blue-500 rounded-xl text-white font-bold flex items-center justify-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),e.jsx("span",{children:"نقل الطالب"})]})]})]})]})})});H.displayName="TransferStudentModal";const G=s.memo(({supervisor:t,onUpdate:c})=>{const[r,l]=s.useState(t.supervisorCapacity||10),[d,m]=s.useState(t.supervisorPriority||0),[x,i]=s.useState(!1);s.useEffect(()=>{l(t.supervisorCapacity||10),m(t.supervisorPriority||0)},[t]);const n=async()=>{i(!0);try{await c(t.id,r,d),alert("تم حفظ الإعدادات بنجاح")}catch(u){alert("فشل الحفظ: "+u.message)}finally{i(!1)}};return e.jsxs("div",{className:"glass-panel p-4 rounded-xl border border-white/5 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-medium",children:t.name}),e.jsx("p",{className:"text-gray-400 text-xs",children:t.email}),e.jsxs("p",{className:"text-emerald-400 text-[10px] mt-1",children:["الطلاب الحاليين: ",t.studentCount||0]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-24",children:[e.jsx("label",{className:"text-[10px] text-gray-400 block mb-1",children:"السعة"}),e.jsx("input",{type:"number",value:r,onChange:u=>l(parseInt(u.target.value)),className:"w-full bg-white/5 border border-white/10 rounded-lg px-2 py-1 text-white text-sm"})]}),e.jsxs("div",{className:"w-24",children:[e.jsx("label",{className:"text-[10px] text-gray-400 block mb-1",children:"الأولوية"}),e.jsx("input",{type:"number",value:d,onChange:u=>m(parseInt(u.target.value)),className:"w-full bg-white/5 border border-white/10 rounded-lg px-2 py-1 text-white text-sm"})]}),e.jsx("button",{onClick:n,disabled:x,className:"mt-4 p-2 bg-emerald-600 hover:bg-emerald-500 rounded-lg text-white disabled:opacity-50",title:"حفظ الإعدادات",children:e.jsx(Me,{className:"w-4 h-4"})})]})]})});G.displayName="SupervisorSettingsCard";const V=s.memo(({isOpen:t,onClose:c,supervisors:r,onUpdate:l})=>t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-[#0a1815] border border-white/10 rounded-3xl w-full max-w-2xl p-6 relative animate-fade-in border-t border-emerald-500/20",children:[e.jsx("button",{onClick:c,className:"absolute left-4 top-4 text-gray-400 hover:text-white transition-colors",children:e.jsx(y,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-6 font-serif",children:"إدارة المشرفين والأولويات"}),e.jsxs("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar",children:[r.map(d=>e.jsx(G,{supervisor:d,onUpdate:l},d.id)),r.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"لا يوجد مشرفين حالياً. قم بترقية أحد الطلاب ليصبح مشرفاً."})]}),e.jsx("div",{className:"pt-6",children:e.jsx("button",{onClick:c,className:"w-full py-3 bg-white/5 hover:bg-white/10 rounded-xl text-gray-300 font-bold",children:"إغلاق"})})]})}):null);V.displayName="SupervisorSettingsModal";const $e=s.memo(({setActiveTab:t,onOpenChat:c})=>{const[r,l]=s.useState([]),[d,m]=s.useState(""),[x,i]=s.useState("all"),[n,u]=s.useState(!1),[j,w]=s.useState(!1),[v,N]=s.useState(!1),[b,k]=s.useState(null),[X,B]=s.useState(null),[C,J]=s.useState([]),[K,A]=s.useState(!1),[Q,M]=s.useState(!1),[W,I]=s.useState(!1),[ze,Ee]=s.useState(null),D=ve(d,300),h=s.useCallback(async()=>{try{const a=await g.getUsers();Array.isArray(a)&&l(a)}catch(a){console.error("Failed to load students",a)}try{const a=await g.supervisors.list();Array.isArray(a)&&J(a)}catch(a){console.error("Failed to load supervisors",a)}},[]);s.useEffect(()=>{h()},[h]);const $=s.useMemo(()=>{const a=D.toLowerCase();return r.filter(o=>{const p=o.name.toLowerCase().includes(a)||o.email.toLowerCase().includes(a),f=x==="all"||o.status===x;return p&&f})},[r,D,x]),{paginatedItems:z,currentPage:O,totalPages:E,nextPage:Y,prevPage:Z}=ye($,{itemsPerPage:10}),ee=s.useCallback(async a=>{try{const o=je(a.name),p=we(a.email);await g.createUser({name:o,nameEn:o,email:p,password:a.password,role:"student",avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(o)}&background=064e3b&color=fff&size=100`,points:0,level:1,streak:0,joinDate:new Date().toISOString().split("T")[0],status:"active"}),u(!1),h()}catch(o){console.error("Failed to add student",o),alert(`حدث خطأ أثناء إضافة الطالب: ${o.message||"خطأ غير معروف"}`)}},[h]),te=s.useCallback(async a=>{await g.deleteUser(a),h()},[h]),se=s.useCallback(async(a,o)=>{await g.updateUser(a,o),w(!1),h()},[h]),ae=s.useCallback(a=>{k(a),w(!0)},[]),le=s.useCallback(a=>{B(a),N(!0)},[]),re=s.useCallback(async(a,o)=>{if(b)try{await g.supervisors.promote(b.id,a,o),I(!1),h()}catch(p){console.error("Failed to promote supervisor",p),alert(`فشل ترقية المشرف: ${p.message}`)}},[b,h]),ie=s.useCallback(async a=>{if(b)try{await g.supervisors.assignStudent(b.id,a),M(!1),h()}catch(o){console.error("Failed to transfer student",o),alert(`فشل نقل الطالب: ${o.message}`)}},[b,h]),oe=s.useCallback(async a=>{if(window.confirm("هل أنت متأكد من إلغاء تعيين هذا المشرف؟ سيتم تحويل طلابه للإدارة."))try{await g.supervisors.demote(a,null),h()}catch(o){console.error("Failed to demote supervisor",o),alert(`فشل إلغاء المشرف: ${o.message}`)}},[h]),ne=s.useCallback(async(a,o,p)=>{try{await g.supervisors.updateSettings(a,o,p),h()}catch(f){console.error("Failed to update settings",f),alert(`فشل تحديث الإعدادات: ${f.message}`)}},[h]);s.useCallback(a=>{window.location.href=`mailto:${a}`},[]);const de=s.useCallback(a=>{m(a.target.value)},[]),ce=s.useCallback(()=>{u(!0)},[]),xe=s.useCallback(()=>{u(!1)},[]),me=s.useMemo(()=>{const a=r.length,o=r.reduce((f,he)=>f+(he.completedLessons||0),0),p=a>0?Math.round(o/(a*20)*100):0;return[{label:"إجمالي الطلاب",value:a,icon:F,color:"from-emerald-500 to-teal-600"},{label:"الطلاب النشطين",value:r.filter(f=>f.status==="active").length,icon:Ne,color:"from-blue-500 to-cyan-600"},{label:"دروس مكتملة",value:o,icon:ue,color:"from-amber-500 to-orange-600"},{label:"معدل الإنجاز",value:`${p}%`,icon:pe,color:"from-purple-500 to-pink-600"}]},[r]);return e.jsxs("div",{className:"animate-fade-in space-y-6 relative",role:"main","aria-label":"إدارة الطلاب",children:[e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"إدارة الطلاب"}),e.jsx("p",{className:"text-gray-300",children:"عرض وإدارة جميع الطلاب المسجلين"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>A(!0),className:"flex items-center gap-2 px-6 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl text-white font-bold transition-all",children:[e.jsx(S,{className:"w-5 h-5 text-emerald-400"}),e.jsx("span",{children:"إدارة المشرفين"})]}),e.jsxs("button",{onClick:ce,className:"flex items-center gap-2 px-6 py-3 bg-emerald-600 hover:bg-emerald-500 rounded-2xl text-white font-bold shadow-lg shadow-emerald-600/20 transition-all transform hover:scale-105",children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{children:"إضافة طالب"})]})]})]}),e.jsx("section",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4","aria-label":"إحصائيات الطلاب",children:me.map((a,o)=>e.jsx(L,{stat:a},o))}),e.jsxs("section",{className:"glass-panel p-4 rounded-2xl flex flex-col md:flex-row gap-4","aria-label":"البحث والتصفية",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(be,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400","aria-hidden":"true"}),e.jsx("input",{type:"search",value:d,onChange:de,placeholder:"بحث عن طالب...",className:"w-full bg-white/5 border border-white/10 rounded-xl py-3 pr-12 pl-4 text-white placeholder-gray-400 focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20","aria-label":"البحث عن طالب"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:x,onChange:a=>i(a.target.value),className:"px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:border-emerald-500 cursor-pointer","aria-label":"تصفية حسب الحالة",children:[e.jsx("option",{value:"all",className:"text-black",children:"جميع الحالات"}),e.jsx("option",{value:"active",className:"text-black",children:"نشط"}),e.jsx("option",{value:"inactive",className:"text-black",children:"غير نشط"})]})})]}),e.jsx("section",{className:"glass-panel rounded-2xl overflow-hidden","aria-label":"قائمة الطلاب",children:e.jsxs("table",{className:"w-full",role:"grid",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10 bg-white/5",children:[e.jsx("th",{className:"py-4 px-6 text-right text-gray-400 font-medium",children:"الطالب"}),e.jsx("th",{className:"py-4 px-6 text-right text-gray-400 font-medium font-serif",children:"تاريخ الانضمام"}),e.jsx("th",{className:"py-4 px-6 text-right text-gray-400 font-medium",children:"المستوى"}),e.jsx("th",{className:"py-4 px-6 text-right text-gray-400 font-medium",children:"الدورات والتقدم"}),e.jsx("th",{className:"py-4 px-6 text-right text-gray-400 font-medium",children:"المشرف"}),e.jsx("th",{className:"py-4 px-6 text-right text-gray-400 font-medium",children:"الحالة"}),e.jsx("th",{className:"py-4 px-6 text-right text-gray-400 font-medium",children:"الإجراءات"})]})}),e.jsx("tbody",{children:z.length>0?z.map(a=>{const o=a;return e.jsx(_,{student:o,supervisors:C,onDelete:te,onEdit:ae,onView:le,onPromote:p=>{k(p),I(!0)},onTransfer:p=>{k(p),M(!0)},onDemote:oe},o.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-8 text-center text-gray-400",children:"لا يوجد طلاب مطابقين للبحث"})})})]})}),e.jsxs("nav",{className:"flex justify-between items-center","aria-label":"التنقل بين الصفحات",children:[e.jsxs("p",{className:"text-gray-400","aria-live":"polite",children:["عرض ",$.length," طالب"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Z,disabled:O===1,className:"px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-gray-300 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"الصفحة السابقة",children:"السابق"}),e.jsxs("span",{className:"px-4 py-2 text-white",children:[O," / ",E]}),e.jsx("button",{onClick:Y,disabled:O===E,className:"px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-gray-300 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"الصفحة التالية",children:"التالي"})]})]}),n&&e.jsx(q,{isOpen:n,onClose:xe,onSubmit:ee}),e.jsx(R,{isOpen:W,onClose:()=>I(!1),student:b,onSubmit:re}),e.jsx(H,{isOpen:Q,onClose:()=>M(!1),student:b,supervisors:C,onSubmit:ie}),e.jsx(V,{isOpen:K,onClose:()=>A(!1),supervisors:C,onUpdate:ne}),j&&b&&e.jsx(De,{isOpen:j,onClose:()=>w(!1),onSubmit:se,student:b}),e.jsx(Se,{isOpen:v,onClose:()=>N(!1),studentId:X})]})});$e.displayName="AdminStudents";export{$e as default};
