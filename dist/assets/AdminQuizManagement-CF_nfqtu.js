import{c as A,r as i,b as o,d as z,C as D,j as e,X as F}from"./index-KPgU3Pk4.js";import{C as M}from"./clock-CbwnHuem.js";import{P as O}from"./plus-7BVga-Rx.js";import{S as P}from"./square-pen-aAMBzuxG.js";import{T as w}from"./trash-2-PnDG24id.js";import{S as $}from"./save-Bprb8m4f.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],N=A("circle-alert",L),H=()=>{var b,j,f;const[c,y]=i.useState([]),[v,d]=i.useState(!1),[x,p]=i.useState(null),[m,C]=i.useState([]),[r,l]=i.useState({title:"",courseId:"",questions:[],passingScore:70,afterEpisodeIndex:3}),[a,h]=i.useState({text:"",options:["","","",""],correctAnswer:0});i.useEffect(()=>{g()},[]);const g=async()=>{const t=await o.getQuizzes();y(t);const s=await o.getCourses();C(s)},S=async t=>{if(confirm("هل أنت متأكد من حذف هذا الاختبار؟"))try{await o.deleteQuiz(t),await g()}catch(s){console.error("Failed to delete quiz:",s),alert("فشل حذف الاختبار.")}},I=t=>{p(t.id),l({title:t.title,courseId:t.courseId,questions:t.questions,passingScore:t.passingScore,afterEpisodeIndex:t.afterEpisodeIndex}),d(!0)},k=()=>{var s;if(!a.text||(s=a.options)!=null&&s.some(n=>!n))return;const t={id:Date.now(),text:a.text||"",textEn:a.text||"",options:a.options,optionsEn:a.options,correctAnswer:a.correctAnswer||0};l({...r,questions:[...r.questions||[],t]}),h({text:"",options:["","","",""],correctAnswer:0})},E=t=>{const s=[...r.questions||[]];s.splice(t,1),l({...r,questions:s})},Q=async t=>{if(t.preventDefault(),!r.courseId){alert("يرجى اختيار الدورة التدريبية");return}if(r.questions.length===0){alert("يجب إضافة سؤال واحد على الأقل للاختبار");return}try{x?await o.updateQuiz(x,r):await o.addQuiz({id:Date.now().toString(),title:r.title||"اختبار جديد",titleEn:r.title||"New Quiz",courseId:r.courseId||"1",questions:r.questions||[],passingScore:r.passingScore||70,afterEpisodeIndex:r.afterEpisodeIndex}),d(!1),p(null),l({title:"",courseId:"",questions:[],passingScore:70,afterEpisodeIndex:3}),await g()}catch(s){console.error("Failed to save quiz:",s),alert("فشل حفظ الاختبار. يرجى التحقق من اتصالك بالخادم.")}},q=[{label:"إجمالي الاختبارات",value:c.length.toString(),icon:z,color:"from-emerald-500 to-teal-600"},{label:"إجمالي الأسئلة",value:c.reduce((t,s)=>{var n;return t+(((n=s.questions)==null?void 0:n.length)||0)},0).toString(),icon:N,color:"from-blue-500 to-cyan-600"},{label:"معدل النجاح",value:"78%",icon:D,color:"from-violet-500 to-purple-600"},{label:"متوسط الوقت",value:"25 د",icon:M,color:"from-amber-500 to-orange-600"}];return e.jsxs("div",{className:"animate-fade-in space-y-6 relative",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"إدارة الاختبارات"}),e.jsx("p",{className:"text-gray-300",children:"إنشاء وإدارة الاختبارات والتقييمات"})]}),e.jsxs("button",{onClick:()=>{p(null),l({title:"",courseId:m.length>0?m[0].id:"",questions:[],passingScore:70,afterEpisodeIndex:3}),d(!0)},className:"px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-bold hover:opacity-90 flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{children:"اختبار جديد"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:q.map((t,s)=>e.jsx("div",{className:"glass-panel p-5 rounded-2xl",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-br ${t.color} flex items-center justify-center`,children:e.jsx(t.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:t.value}),e.jsx("p",{className:"text-gray-400 text-sm",children:t.label})]})]})},s))}),e.jsx("div",{className:"glass-panel rounded-2xl overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10 bg-white/5",children:[e.jsx("th",{className:"text-right py-4 px-6 text-gray-300 font-medium",children:"الاختبار"}),e.jsx("th",{className:"text-right py-4 px-6 text-gray-300 font-medium",children:"الأسئلة"}),e.jsx("th",{className:"text-right py-4 px-6 text-gray-300 font-medium",children:"درجة النجاح"}),e.jsx("th",{className:"text-right py-4 px-6 text-gray-300 font-medium",children:"إجراءات"})]})}),e.jsxs("tbody",{children:[c.map(t=>{var s;return e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:t.title}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Course ID: ",t.courseId]})]})}),e.jsx("td",{className:"py-4 px-6 text-white",children:((s=t.questions)==null?void 0:s.length)||0}),e.jsxs("td",{className:"py-4 px-6 text-white",children:[t.passingScore,"%"]}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>I(t),className:"p-2 rounded-lg bg-white/5 text-gray-400 hover:text-white",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(t.id),className:"p-2 rounded-lg bg-white/5 text-gray-400 hover:text-red-400",children:e.jsx(w,{className:"w-4 h-4"})})]})})]},t.id)}),c.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-8 text-center text-gray-400",children:"لا توجد اختبارات حالياً"})})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-[#0a1815] border border-white/10 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto custom-scrollbar relative",children:[e.jsx("button",{onClick:()=>d(!1),className:"absolute left-4 top-4 text-gray-400 hover:text-white",children:e.jsx(F,{className:"w-6 h-6"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-6",children:x?"تعديل اختبار":"إضافة اختبار جديد"}),e.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"عنوان الاختبار"}),e.jsx("input",{required:!0,value:r.title,onChange:t=>l({...r,title:t.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"الدورة التدريبية"}),e.jsxs("select",{required:!0,value:r.courseId,onChange:t=>l({...r,courseId:t.target.value}),className:"w-full bg-[#0a1815] border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500 appearance-none",children:[e.jsx("option",{value:"",children:"اختر الدورة..."}),m.map(t=>{var s;return e.jsxs("option",{value:t.id,children:[t.title," (",t.lessonsCount||((s=t.episodes)==null?void 0:s.length)||0," محاضرة)"]},t.id)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"يظهر بعد المحاضرة رقم"}),e.jsx("input",{type:"number",required:!0,min:"0",value:r.afterEpisodeIndex,onChange:t=>l({...r,afterEpisodeIndex:parseInt(t.target.value)}),className:"w-full bg-[#0a1815] border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500"}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{var n;const t=m.find(u=>u.id===r.courseId),s=(t==null?void 0:t.lessonsCount)||((n=t==null?void 0:t.episodes)==null?void 0:n.length)||0;l({...r,afterEpisodeIndex:s})},className:"text-[10px] bg-emerald-500/10 text-emerald-400 px-2 py-1 rounded hover:bg-emerald-500/20 transition-colors",children:"تعيين كاختبار نهائي"}),e.jsxs("p",{className:"text-[10px] text-gray-500 flex items-center gap-1",children:[e.jsx(N,{className:"w-3 h-3"}),"اتركه 0 إذا كان الاختبار متاحاً من البداية"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"درجة النجاح (%)"}),e.jsx("input",{type:"number",required:!0,min:"0",max:"100",value:r.passingScore,onChange:t=>l({...r,passingScore:parseInt(t.target.value)}),className:"w-full bg-[#0a1815] border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500"})]})]}),e.jsxs("div",{className:"border-t border-white/10 pt-4",children:[e.jsxs("h4",{className:"text-lg font-bold text-white mb-4",children:["الأسئلة (",(b=r.questions)==null?void 0:b.length,")"]}),e.jsx("div",{className:"space-y-4 mb-4 max-h-60 overflow-y-auto pr-2",children:(j=r.questions)==null?void 0:j.map((t,s)=>e.jsxs("div",{className:"bg-white/5 p-4 rounded-xl flex justify-between items-center group",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:t.text}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["الإجابة الصحيحة: ",t.options[t.correctAnswer]]})]}),e.jsx("button",{type:"button",onClick:()=>E(s),className:"p-2 text-red-400 hover:bg-white/10 rounded-lg",children:e.jsx(w,{className:"w-4 h-4"})})]},s))}),e.jsxs("div",{className:"bg-white/5 p-5 rounded-xl border border-white/10",children:[e.jsx("h5",{className:"text-emerald-400 font-bold mb-4 text-sm",children:"إضافة سؤال جديد"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{placeholder:"نص السؤال",value:a.text,onChange:t=>h({...a,text:t.target.value}),className:"w-full bg-black/20 border border-white/10 rounded-lg px-3 py-2 text-white text-sm"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:(f=a.options)==null?void 0:f.map((t,s)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{placeholder:`الخيار ${s+1}`,value:t,onChange:n=>{const u=[...a.options||[]];u[s]=n.target.value,h({...a,options:u})},className:`flex-1 bg-black/20 border ${a.correctAnswer===s?"border-emerald-500":"border-white/10"} rounded-lg px-3 py-2 text-white text-sm`}),e.jsx("input",{type:"radio",name:"correctAnswer",checked:a.correctAnswer===s,onChange:()=>h({...a,correctAnswer:s}),className:"mt-3"})]},s))}),e.jsx("button",{type:"button",onClick:k,className:"w-full py-2 bg-emerald-600/50 hover:bg-emerald-600 rounded-lg text-white text-sm font-bold transition-colors",children:"+ إضافة السؤال"})]})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-3 bg-emerald-600 hover:bg-emerald-500 rounded-xl text-white font-bold transition-colors flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{children:x?"حفظ التعديلات":"إنشاء الاختبار"})]})]})]})]})})]})};export{H as default};
