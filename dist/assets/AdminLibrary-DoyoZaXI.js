import{d as T,u as U,b as J,r as a,j as e,P as V,S as C,X as S}from"./index-PO4O9_Fr.js";import{B as X}from"./book-BSKb7tQp.js";import{S as H}from"./square-pen-9VgwtPiN.js";import{T as K}from"./trash-2-B1SjAVum.js";import{G as B}from"./globe-H-Auzyor.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["circle",{cx:"11.5",cy:"14.5",r:"2.5",key:"1bq0ko"}],["path",{d:"M13.3 16.3 15 18",key:"2quom7"}]],W=T("file-search",Q);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Z=T("link",Y),le=()=>{const{t:s}=U(),{success:u,error:c}=J(),[f,b]=a.useState([]),[L,E]=a.useState([]),[d,R]=a.useState(""),[I,M]=a.useState(!0),[P,g]=a.useState(!1),[n,x]=a.useState(null),[l,i]=a.useState({title:"",path:"",courseId:""}),[q,h]=a.useState(!1),[j,F]=a.useState([]),[_,y]=a.useState(!1),[w,O]=a.useState("");a.useEffect(()=>{N(),z()},[]);const N=async()=>{try{const t=await fetch("/api/books");if(t.ok){const r=await t.json();b(r)}}catch(t){console.error("Error fetching books:",t),t("فشل تحميل الكتب")}finally{M(!1)}},z=async()=>{try{const t=await fetch("/api/courses");if(t.ok){const r=await t.json();E(r)}}catch(t){console.error("Error fetching courses:",t)}},D=async()=>{y(!0);try{const t=await fetch("/api/r2/files?prefix=Books/");if(t.ok){const r=await t.json();F(r.files||[])}}catch(t){console.error("Error fetching R2 files:",t),t("فشل استعراض الملفات")}finally{y(!1)}},$=t=>{const r=t.name;let o=r.replace(/\.[^/.]+$/,"").replace(/[_-]/g," ");o=o.charAt(0).toUpperCase()+o.slice(1),i({...l,path:r,title:l.title||o}),h(!1)},A=async t=>{if(t.preventDefault(),!l.title||!l.path){c("يرجى تعبئة العنوان ومسار الملف");return}const r=n?`/api/books/${n.id}`:"/api/books",o=n?"PUT":"POST";try{(await fetch(r,{method:o,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).ok?(u(n?"تم تحديث الكتاب بنجاح":"تم إضافة الكتاب بنجاح"),N(),m()):c("حدث خطأ أثناء الحفظ")}catch(p){console.error("Error saving book:",p),p("فشل الاتصال الخادم")}},G=async t=>{if(confirm("هل أنت متأكد من حذف هذا الكتاب من المكتبة؟"))try{(await fetch(`/api/books/${t}`,{method:"DELETE"})).ok?(u("تم حذف الكتاب بنجاح"),b(f.filter(o=>o.id!==t))):c("فشل الحذف")}catch(r){console.error("Error deleting book:",r),r("حدث خطأ")}},v=t=>{t?(x(t),i({title:t.title,path:t.path,courseId:t.courseId||""})):(x(null),i({title:"",path:"",courseId:""})),g(!0)},m=()=>{g(!1),x(null)},k=f.filter(t=>t.title.toLowerCase().includes(d.toLowerCase())||t.path.toLowerCase().includes(d.toLowerCase()));return e.jsxs("div",{className:"animate-fade-in space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:s("admin.library")}),e.jsx("p",{className:"text-gray-300",children:"إدارة الكتب وربطها بالمساقات"})]}),e.jsxs("button",{onClick:()=>v(),className:"px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-bold hover:opacity-90 flex items-center gap-2 transition-all shadow-lg shadow-emerald-600/20",children:[e.jsx(V,{className:"w-5 h-5"}),e.jsx("span",{children:s("admin.addBook")})]})]}),e.jsxs("div",{className:"glass-panel p-4 rounded-2xl flex items-center gap-4",children:[e.jsx(C,{className:"w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:s("admin.searchPlaceholder"),value:d,onChange:t=>R(t.target.value),className:"flex-1 bg-transparent border-none text-white focus:ring-0 placeholder-gray-500"})]}),e.jsx("div",{className:"glass-panel rounded-2xl overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10 bg-white/5",children:[e.jsx("th",{className:"text-right py-4 px-6 text-gray-300 font-medium",children:s("admin.bookTitle")}),e.jsx("th",{className:"text-right py-4 px-6 text-gray-300 font-medium",children:s("admin.bookPath")}),e.jsx("th",{className:"text-right py-4 px-6 text-gray-300 font-medium",children:s("admin.linkedCourse")}),e.jsx("th",{className:"text-right py-4 px-6 text-gray-300 font-medium",children:s("admin.actions")})]})}),e.jsx("tbody",{children:I?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-8 text-gray-400",children:"جاري التحميل..."})}):k.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-8 text-gray-400",children:"لا توجد كتب مضافة"})}):k.map(t=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors group",children:[e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center text-emerald-400",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-white font-medium",children:t.title})]})}),e.jsx("td",{className:"py-4 px-6 text-gray-400 font-mono text-sm",dir:"ltr",children:e.jsx("a",{href:`https://pub-7ec5f52937cb4e729e07ecf35b1cf007.r2.dev/Books/${t.path}`,target:"_blank",rel:"noopener noreferrer",className:"hover:text-emerald-400",children:t.path})}),e.jsx("td",{className:"py-4 px-6",children:t.courseTitle?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-violet-500/20 text-violet-300 text-xs font-bold border border-violet-500/10",children:[e.jsx(Z,{className:"w-3 h-3"}),t.courseTitle]}):e.jsx("span",{className:"text-gray-500 text-xs",children:s("admin.noCourse")})}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>v(t),className:"p-2 rounded-lg hover:bg-white/10 text-gray-400 hover:text-white transition-colors",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>G(t.id),className:"p-2 rounded-lg hover:bg-red-500/10 text-gray-400 hover:text-red-400 transition-colors",children:e.jsx(K,{className:"w-4 h-4"})})]})})]},t.id))})]})}),P&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-[#0a1f1c] border border-white/10 rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl animate-scale-in",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 flex justify-between items-center bg-white/5",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:s(n?"admin.editBook":"admin.addBook")}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-white",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:A,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:s("admin.bookTitle")}),e.jsx("input",{type:"text",required:!0,value:l.title,onChange:t=>i({...l,title:t.target.value}),className:"w-full bg-black/20 border border-white/10 rounded-xl px-4 py-2.5 text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none transition-all",placeholder:"مثال: كتاب الطهارة"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:s("admin.bookPath")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",required:!0,value:l.path,onChange:t=>i({...l,path:t.target.value}),className:"w-full bg-black/20 border border-white/10 rounded-xl px-4 py-2.5 text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none transition-all pl-10",placeholder:"مثال: purity_book.pdf",dir:"ltr"}),e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-xs font-mono",children:"/Books/"})]}),e.jsx("button",{type:"button",onClick:()=>{h(!0),D()},className:"px-3 bg-white/5 border border-white/10 rounded-xl text-gray-400 hover:text-white hover:bg-white/10 transition-all flex items-center gap-2",title:"استعراض الملفات في السحابة",children:e.jsx(B,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"تأكد من وجود الملف في مجلد Books في السيرفر أو استعرض الملفات"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:s("admin.linkedCourse")}),e.jsxs("select",{value:l.courseId,onChange:t=>i({...l,courseId:t.target.value}),className:"w-full bg-black/20 border border-white/10 rounded-xl px-4 py-2.5 text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none transition-all",children:[e.jsx("option",{value:"",children:s("admin.noCourse")}),L.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:m,className:"px-5 py-2 rounded-xl text-gray-300 hover:text-white hover:bg-white/5 transition-colors",children:s("admin.cancel")}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-bold shadow-lg shadow-emerald-900/20 transition-all transform hover:scale-105",children:s("admin.save")})]})]})]})}),q&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/70 backdrop-blur-md",children:e.jsxs("div",{className:"bg-[#0f2e2a] border border-emerald-500/20 rounded-2xl w-full max-w-2xl max-h-[80vh] flex flex-col shadow-2xl animate-scale-in",children:[e.jsxs("div",{className:"p-5 border-b border-white/10 flex justify-between items-center bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-5 h-5 text-emerald-400"}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"متصفح ملفات الكتب (R2)"})]}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-white",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"بحث في ملفات السحابة...",value:w,onChange:t=>O(t.target.value),className:"w-full bg-black/20 border border-white/5 rounded-xl pr-9 pl-4 py-2 text-sm text-white focus:border-emerald-500/50 outline-none transition-all"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar",children:_?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-500",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{children:"جاري تحميل قائمة الملفات..."})]}):j.length===0?e.jsx("div",{className:"text-center py-20 text-gray-500",children:"لا توجد ملفات في مجلد Books"}):e.jsx("div",{className:"grid grid-cols-1 gap-1",children:j.filter(t=>t.name.toLowerCase().includes(w.toLowerCase())).map(t=>e.jsxs("button",{onClick:()=>$(t),className:"w-full text-right p-3 rounded-xl hover:bg-white/5 flex items-center justify-between group transition-colors border border-transparent hover:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-500 shrink-0",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"text-white text-sm font-medium truncate",dir:"ltr",children:t.name}),e.jsxs("div",{className:"text-[10px] text-gray-500 uppercase",children:[t.id.split(".").pop()," file"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 shrink-0",children:[(t.size/(1024*1024)).toFixed(2)," MB"]})]},t.id))})}),e.jsxs("div",{className:"p-4 bg-black/20 text-center text-xs text-gray-500 rounded-b-2xl border-t border-white/5",children:["المسار المتصفح حالياً: ",e.jsx("span",{className:"font-mono text-emerald-400/80",children:"R2://Books/"})]})]})})]})};export{le as default};
