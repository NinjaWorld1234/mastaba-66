import{d as H,r as s,a as Q,b as P,j as e,X as j,M as W,f as _,u as T,A as U,c as X}from"./index-PO4O9_Fr.js";import{S as q}from"./star-DEkBOYX3.js";import{G as Y}from"./globe-H-Auzyor.js";import{S as B}from"./send-DS51h8Hw.js";import{C as D}from"./circle-check-Cvzek-8H.js";import{E as J}from"./eye-DOTsDHGN.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],I=H("arrow-left",K),V=({isOpen:i,onClose:b})=>{const[o,c]=s.useState(0),[S,h]=s.useState(0),[n,f]=s.useState(""),[a,d]=s.useState(!1),{user:g}=Q(),u=P();if(!i)return null;const p=async()=>{if(o===0){u.error("يرجى اختيار التقييم بالنجوم أولاً");return}d(!0);try{await _.submitRating(o,n),u.success("شكراً لك على تقييمك! سيظهر رأيك في الواجهة الرئيسية."),b()}catch{u.error("حدث خطأ أثناء إرسال التقييم")}finally{d(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-md animate-fade-in",onClick:b}),e.jsxs("div",{className:"relative w-full max-w-lg glass-panel bg-[#0a1815] border border-white/10 rounded-[2.5rem] overflow-hidden shadow-2xl animate-scale-in",children:[e.jsx("div",{className:"absolute top-0 inset-x-0 h-32 bg-gradient-to-b from-emerald-500/10 to-transparent pointer-events-none"}),e.jsx("button",{onClick:b,className:"absolute top-6 right-6 p-2 text-gray-400 hover:text-white hover:bg-white/5 rounded-full transition-all z-10",children:e.jsx(j,{className:"w-5 h-5"})}),e.jsxs("div",{className:"p-8 md:p-12 relative z-10 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-emerald-500/20 rounded-3xl flex items-center justify-center mx-auto mb-6 border border-emerald-500/30",children:e.jsx(q,{className:"w-10 h-10 text-emerald-400 fill-emerald-400"})}),e.jsx("h2",{className:"text-3xl font-extrabold text-white mb-2 font-serif tracking-tight",children:"ما هو تقييمك لمصطبتنا؟"}),e.jsx("p",{className:"text-gray-400 mb-10 text-lg",children:"رأيك يهمنا جداً في تطوير المحتوى وتجربة التعلم"}),e.jsx("div",{className:"flex justify-center gap-3 mb-10",children:[1,2,3,4,5].map(r=>e.jsx("button",{className:"transform hover:scale-125 transition-all duration-300 outline-none",onMouseEnter:()=>h(r),onMouseLeave:()=>h(0),onClick:()=>c(r),"aria-label":`Rate ${r} stars`,children:e.jsx(q,{className:`w-12 h-12 ${(S||o)>=r?"text-amber-400 fill-amber-400":"text-white/10"}`})},r))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-4 right-4 text-emerald-500",children:e.jsx(W,{className:"w-5 h-5"})}),e.jsx("textarea",{value:n,onChange:r=>f(r.target.value),placeholder:"اكتب رأيك في المادة التعليمية والمنصة بشكل عام...",className:"w-full h-32 bg-black/40 border border-white/10 rounded-[1.5rem] pr-12 pl-4 py-4 text-white placeholder:text-gray-600 focus:outline-none focus:border-emerald-500/50 focus:ring-4 focus:ring-emerald-500/5 transition-all resize-none text-right font-medium"})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-center text-xs text-gray-500 mb-2",children:[e.jsx(Y,{className:"w-3 h-3"}),e.jsxs("span",{children:["سيظهر اسمك (",g==null?void 0:g.name,") وبلدك مع تعليقك للجميع."]})]}),e.jsx("button",{onClick:p,disabled:a||o===0,className:`
                                w-full py-5 rounded-[1.5rem] font-black text-xl flex items-center justify-center gap-3 transition-all transform shadow-xl
                                ${a||o===0?"bg-white/5 text-gray-500 border border-white/5 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-500 text-white shadow-emerald-900/30 hover:scale-[1.02] active:scale-95"}
                            `,children:a?e.jsx("div",{className:"w-6 h-6 border-3 border-white/20 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"إرسال التقييم"}),e.jsx(B,{className:"w-5 h-5"})]})})]}),e.jsx("p",{className:"mt-8 text-gray-500 text-[10px] uppercase font-bold tracking-widest",children:"Muslim Youth Forum Feedback System"})]})]})]})},Z=s.memo(V),ie=({quiz:i,onSuccess:b,onClose:o})=>{var M;const{t:c,language:S}=T(),{user:h}=Q(),[n,f]=s.useState(0),[a,d]=s.useState(null),[g,u]=s.useState(!1),[p,r]=s.useState(0),[k,C]=s.useState(!1),[R,$]=s.useState([]),[E,N]=s.useState(!1),[F,A]=s.useState(!1);if(!i.questions||i.questions.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] text-center",children:[e.jsx(j,{className:"w-16 h-16 text-red-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"هذا الاختبار لا يحتوي على أسئلة حالياً"}),e.jsx("button",{onClick:o,className:"mt-4 px-6 py-2 bg-white/10 text-white rounded-lg hover:bg-white/20",children:"إغلاق"})]});const v=i.questions[n],x=i.questions.length,y=i.passingScore||70,L=()=>{const l=a===v.correctAnswer,t=[...R,a];$(t);let m=p;l&&(m=p+1,r(m)),n<x-1?(f(w=>w+1),d(null)):O(m)},O=async l=>{C(!0);try{await X.quizResults.save(i.id,l,x),u(!0),l/x*100>=y&&(A(!0),b())}catch(t){console.error("Quiz save error:",t)}finally{C(!1)}},G=()=>{n>0&&(f(l=>l-1),d(null))};if(g){const l=Math.round(p/x*100),t=l>=y;return E?e.jsxs("div",{className:"max-w-3xl mx-auto py-10 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"مراجعة الأخطاء"}),e.jsxs("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-white flex items-center gap-2 transition-colors",children:[e.jsx(I,{className:"w-5 h-5"}),e.jsx("span",{children:"العودة للنتيجة"})]})]}),e.jsx("div",{className:"space-y-6",children:i.questions.map((m,w)=>{const z=R[w];return z!==m.correctAnswer?e.jsxs("div",{className:"glass-panel p-6 rounded-2xl border-l-4 border-red-500 bg-red-500/5",children:[e.jsxs("p",{className:"text-white font-medium mb-4",children:[w+1,". ",m.text]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"p-3 rounded-xl bg-white/5 border border-white/10 text-red-400 flex items-center gap-3",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsxs("span",{children:["إجابتك: ",m.options[z]]})]})}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-2",children:"الإجابة التي اخترتها خاطئة. يرجى مراجعة الدرس المتعلق بهذا السؤال."})]},w):null})}),e.jsx("button",{onClick:()=>N(!1),className:"w-full mt-8 py-4 rounded-2xl bg-white/5 text-white font-bold hover:bg-white/10 transition-all border border-white/10",children:"العودة للنتيجة"})]}):e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[60vh] animate-fade-in py-10",children:e.jsxs("div",{className:"glass-panel p-10 rounded-3xl text-center max-w-lg w-full relative overflow-hidden border-2 border-white/5",children:[e.jsx("div",{className:`absolute -top-24 -right-24 w-48 h-48 rounded-full blur-3xl opacity-20 ${t?"bg-emerald-500":"bg-red-500"}`}),e.jsx("div",{className:`w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 ${t?"bg-emerald-500/20":"bg-red-500/20"}`,children:t?e.jsx(D,{className:"w-12 h-12 text-emerald-400"}):e.jsx(j,{className:"w-12 h-12 text-red-400"})}),e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:t?"أحسنت صنعاً!":"تحتاج لمراجعة أكثر"}),e.jsx("p",{className:"text-gray-300 mb-8",children:t?`تهانينا ${((M=h==null?void 0:h.name)==null?void 0:M.split(" ")[0])||""}، لقد اجتزت الاختبار بنجاح.`:"للأسف لم تصل لدرجة النجاح المطلوبة هذه المرة."}),e.jsx("div",{className:"flex justify-center items-end gap-2 mb-2",children:e.jsxs("div",{className:`text-6xl font-bold ${t?"text-emerald-400":"text-red-400"}`,children:[l,"%"]})}),e.jsxs("div",{className:"flex flex-col gap-1 items-center mb-8",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"درجتك النهائية"}),e.jsxs("p",{className:"text-xs text-amber-500 font-bold bg-amber-500/10 px-3 py-1 rounded-full",children:["مطلوب ",y,"% للنجاح"]})]}),!t&&e.jsxs("button",{onClick:()=>N(!0),className:"w-full mb-4 py-3 rounded-xl bg-violet-600/20 text-violet-300 border border-violet-500/30 hover:bg-violet-600/30 transition-all flex items-center justify-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"مراجعة الأسئلة الخاطئة"]}),e.jsxs("div",{className:"flex gap-4",children:[!t&&e.jsx("button",{onClick:()=>{u(!1),f(0),r(0),d(null),$([])},className:"flex-1 py-4 rounded-xl border border-white/10 text-white hover:bg-white/5 transition-colors font-bold",children:"إعادة المحاولة"}),e.jsx("button",{onClick:o,className:`py-4 rounded-xl text-white font-bold transition-colors ${t?"w-full bg-emerald-600 hover:bg-emerald-500":"flex-1 bg-white/10 hover:bg-white/20"}`,children:"إغلاق"})]})]})})}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-w-3xl mx-auto py-10 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("span",{className:"text-gray-400",children:c("quiz.questionCount").replace("{{current}}",(n+1).toString()).replace("{{total}}",x.toString())}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-red-400",children:c("quiz.remainingAttempts")}),e.jsx("div",{className:"w-32 h-2 bg-gray-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gold-500",style:{width:`${(n+1)/x*100}%`}})})]})]}),e.jsxs("div",{className:"glass-panel p-8 md:p-12 rounded-[2rem] border-2 border-white/5",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-10 leading-relaxed",children:v.text}),e.jsx("div",{className:"space-y-4",children:v.options.map((l,t)=>e.jsxs("button",{onClick:()=>d(t),className:`w-full p-5 rounded-2xl flex items-center gap-4 transition-all duration-300 border ${a===t?"bg-emerald-500/20 border-emerald-500":"bg-white/5 border-transparent hover:bg-white/10"}`,children:[e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${a===t?"border-emerald-500 bg-emerald-500":"border-gray-500"}`,children:a===t&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),e.jsx("span",{className:`text-lg ${a===t?"text-white font-medium":"text-gray-300"}`,children:l})]},t))}),e.jsxs("div",{className:"flex justify-between mt-12 pt-8 border-t border-white/10",children:[e.jsxs("button",{disabled:n===0,onClick:G,className:"flex items-center gap-2 px-6 py-3 rounded-xl text-gray-400 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(U,{className:"w-5 h-5"}),e.jsx("span",{children:c("quiz.previous")})]}),e.jsx("button",{disabled:a===null||k,onClick:L,className:"flex items-center gap-2 px-10 py-3 rounded-xl bg-gold-500 hover:bg-gold-600 text-black font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-lg shadow-gold-500/20",children:k?e.jsx("span",{children:"..."}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:n===x-1?c("quiz.finish"):c("quiz.next")}),e.jsx(I,{className:"w-5 h-5"})]})})]})]})]}),e.jsx(Z,{isOpen:F,onClose:()=>{A(!1),o()}})]})};export{ie as default};
