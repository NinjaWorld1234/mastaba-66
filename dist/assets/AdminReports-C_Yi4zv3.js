import{c as M,r as c,R as w,j as n,D as $,T,k as U,b as N}from"./index-CZK59VbI.js";import{P as I}from"./printer-BuYAGs-o.js";import{C as B}from"./clock-DVVeJK1Y.js";import{A as S}from"./arrow-up-right-CMyeOZBE.js";import{v as R,c as W,C as H,at as K,u as F,au as q,av as V,aw as G,ax as X,ay as Y,az as J,a2 as Z,w as z,aA as Q,aB as E,R as k}from"./CategoricalChart-BSo9d02g.js";import{A as ee,a as te}from"./AreaChart-CZ4eN20I.js";import{d as re,g as ne,c as ae,X as oe,Y as ie,T as C}from"./CartesianChart-CyMhDQ5h.js";import{P as se,a as le}from"./PieChart-D1dmVz_j.js";import{g as ce,C as de}from"./PolarChart-o9DAolbz.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],D=M("arrow-down-right",ue);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],me=M("trending-down",he);function P(){return P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)({}).hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},P.apply(null,arguments)}function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,a)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?A(Object(r),!0).forEach(function(a){ge(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function ge(e,t,r){return(t=fe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fe(e){var t=xe(e,"string");return typeof t=="symbol"?t:t+""}function xe(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var a=r.call(e,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var b=32,be={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function ve(e){var{data:t,iconType:r,inactiveColor:a}=e,i=b/2,d=b/6,g=b/3,h=t.inactive?a:t.color,u=r??t.type;if(u==="none")return null;if(u==="plainline"){var m;return c.createElement("line",{strokeWidth:4,fill:"none",stroke:h,strokeDasharray:(m=t.payload)===null||m===void 0?void 0:m.strokeDasharray,x1:0,y1:i,x2:b,y2:i,className:"recharts-legend-icon"})}if(u==="line")return c.createElement("path",{strokeWidth:4,fill:"none",stroke:h,d:"M0,".concat(i,"h").concat(g,`
            A`).concat(d,",").concat(d,",0,1,1,").concat(2*g,",").concat(i,`
            H`).concat(b,"M").concat(2*g,",").concat(i,`
            A`).concat(d,",").concat(d,",0,1,1,").concat(g,",").concat(i),className:"recharts-legend-icon"});if(u==="rect")return c.createElement("path",{stroke:"none",fill:h,d:"M0,".concat(b/8,"h").concat(b,"v").concat(b*3/4,"h").concat(-b,"z"),className:"recharts-legend-icon"});if(c.isValidElement(t.legendIcon)){var s=pe({},t);return delete s.legendIcon,c.cloneElement(t.legendIcon,s)}return c.createElement(ce,{fill:h,cx:i,cy:i,size:b,sizeType:"diameter",type:u})}function ye(e){var{payload:t,iconSize:r,layout:a,formatter:i,inactiveColor:d,iconType:g}=e,h={x:0,y:0,width:b,height:b},u={display:a==="horizontal"?"inline-block":"block",marginRight:10},m={display:"inline-block",verticalAlign:"middle",marginRight:4};return t.map((s,f)=>{var v=s.formatter||i,j=W({"recharts-legend-item":!0,["legend-item-".concat(f)]:!0,inactive:s.inactive});if(s.type==="none")return null;var o=s.inactive?d:s.color,l=v?v(s.value,s,f):s.value;return c.createElement("li",P({className:j,style:u,key:"legend-item-".concat(f)},H(e,s,f)),c.createElement(K,{width:r,height:r,viewBox:h,style:m,"aria-label":"".concat(l," legend icon")},c.createElement(ve,{data:s,iconType:g,inactiveColor:d})),c.createElement("span",{className:"recharts-legend-item-text",style:{color:o}},l))})}var je=e=>{var t=R(e,be),{payload:r,layout:a,align:i}=t;if(!r||!r.length)return null;var d={padding:0,margin:0,textAlign:a==="horizontal"?i:"left"};return c.createElement("ul",{className:"recharts-default-legend",style:d},c.createElement(ye,P({},t,{payload:r})))};function we(){return F(q)}var Pe=["contextPayload"];function O(){return O=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)({}).hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},O.apply(null,arguments)}function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,a)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?L(Object(r),!0).forEach(function(a){Oe(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function Oe(e,t,r){return(t=Ne(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ne(e){var t=Se(e,"string");return typeof t=="symbol"?t:t+""}function Se(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var a=r.call(e,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ee(e,t){if(e==null)return{};var r,a,i=ke(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)r=d[a],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function ke(e,t){if(e==null)return{};var r={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(t.indexOf(a)!==-1)continue;r[a]=e[a]}return r}function Ce(e){return e.value}function De(e){var{contextPayload:t}=e,r=Ee(e,Pe),a=ne(t,e.payloadUniqBy,Ce),i=y(y({},r),{},{payload:a});return c.isValidElement(e.content)?c.cloneElement(e.content,i):typeof e.content=="function"?c.createElement(e.content,i):c.createElement(je,i)}function Ae(e,t,r,a,i,d){var{layout:g,align:h,verticalAlign:u}=t,m,s;return(!e||(e.left===void 0||e.left===null)&&(e.right===void 0||e.right===null))&&(h==="center"&&g==="vertical"?m={left:((a||0)-d.width)/2}:m=h==="right"?{right:r&&r.right||0}:{left:r&&r.left||0}),(!e||(e.top===void 0||e.top===null)&&(e.bottom===void 0||e.bottom===null))&&(u==="middle"?s={top:((i||0)-d.height)/2}:s=u==="bottom"?{bottom:r&&r.bottom||0}:{top:r&&r.top||0}),y(y({},m),s)}function Le(e){var t=z();return c.useEffect(()=>{t(Q(e))},[t,e]),null}function Me(e){var t=z();return c.useEffect(()=>(t(E(e)),()=>{t(E({width:0,height:0}))}),[t,e]),null}function Re(e,t,r,a){return e==="vertical"&&Z(t)?{height:t}:e==="horizontal"?{width:r||a}:null}var ze={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function _(e){var t=R(e,ze),r=we(),a=V(),i=G(),{width:d,height:g,wrapperStyle:h,portal:u}=t,[m,s]=re([r]),f=X(),v=Y();if(f==null||v==null)return null;var j=f-((i==null?void 0:i.left)||0)-((i==null?void 0:i.right)||0),o=Re(t.layout,g,d,j),l=u?h:y(y({position:"absolute",width:(o==null?void 0:o.width)||d||"auto",height:(o==null?void 0:o.height)||g||"auto"},Ae(h,t,i,f,v,m)),h),p=u??a;if(p==null||r==null)return null;var x=c.createElement("div",{className:"recharts-legend-wrapper",style:l,ref:s},c.createElement(Le,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),!u&&c.createElement(Me,{width:m.width,height:m.height}),c.createElement(De,O({},t,o,{margin:i,chartWidth:f,chartHeight:v,contextPayload:r})));return J.createPortal(x,p)}_.displayName="Legend";const Fe=()=>{const[e,t]=w.useState([]),[r,a]=w.useState([]),[i,d]=w.useState(!0);w.useEffect(()=>{(async()=>{try{const[l,p]=await Promise.all([N.getUsers(),N.getCourses()]);t(Array.isArray(l)?l:[]),a(Array.isArray(p)?p:[])}catch(l){console.error("Failed to fetch report data",l)}finally{d(!1)}})()},[]),e.filter(o=>o.role==="student").length;const g=c.useMemo(()=>{if(!r||r.length===0)return 0;const o=r.reduce((l,p)=>l+(p.progress||0),0);return Math.round(o/r.length)},[r]),h=c.useMemo(()=>{const o={};r.forEach(p=>{const x=p.category||"أخرى";o[x]=(o[x]||0)+1});const l=["#10b981","#3b82f6","#8b5cf6","#f59e0b","#6b7280"];return Object.keys(o).map((p,x)=>({name:p,value:o[p],color:l[x%l.length]}))},[r]),u=c.useMemo(()=>[...r].sort((o,l)=>(l.studentsCount||0)-(o.studentsCount||0)).slice(0,5).map(o=>({name:o.title,students:o.studentsCount||0,growth:Math.floor(Math.random()*20)-5})),[r]),m=[{label:"معدل إكمال الدورات",value:`${g}%`,change:"+5%",trend:"up",icon:T},{label:"متوسط وقت الدراسة",value:"45 د",change:"+12%",trend:"up",icon:B},{label:"رضا الطلاب",value:"4.8/5",change:"+0.2",trend:"up",icon:U},{label:"معدل التسرب",value:"2%",change:"-2%",trend:"down",icon:me}],s=Math.max(e.length,100),f=[{month:"يناير",students:Math.max(0,s-50),courses:5,hours:450},{month:"فبراير",students:Math.max(0,s-40),courses:8,hours:620},{month:"مارس",students:Math.max(0,s-30),courses:12,hours:890},{month:"أبريل",students:Math.max(0,s-20),courses:15,hours:1100},{month:"مايو",students:Math.max(0,s-10),courses:18,hours:1450},{month:"يونيو",students:s,courses:r.length||20,hours:1800}];if(i)return n.jsx("div",{className:"flex justify-center items-center h-64",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"})});const v=()=>{window.print()},j=()=>{const o={generatedAt:new Date().toISOString(),kpis:m,courseDistribution:h,topCourses:u,monthlyData:f},l=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),p=URL.createObjectURL(l),x=document.createElement("a");x.href=p,x.download=`report-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(p)};return n.jsxs("div",{className:"animate-fade-in space-y-6 print:space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center print:hidden",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"التقارير والإحصائيات"}),n.jsx("p",{className:"text-gray-300",children:"تحليلات شاملة لأداء المنصة"})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:v,className:"px-4 py-2 bg-white/5 border border-white/10 rounded-xl text-white hover:bg-white/10 transition-colors flex items-center gap-2",children:[n.jsx(I,{className:"w-5 h-5"}),n.jsx("span",{children:"طباعة"})]}),n.jsxs("button",{onClick:j,className:"px-6 py-2 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-bold hover:opacity-90 transition-opacity flex items-center gap-2",children:[n.jsx($,{className:"w-5 h-5"}),n.jsx("span",{children:"تصدير"})]})]})]}),n.jsxs("div",{className:"hidden print:block text-center mb-8",children:[n.jsx("h1",{className:"text-2xl font-bold text-black mb-2",children:"تقرير منصة المصطبة العلمية"}),n.jsx("p",{className:"text-gray-600",children:new Date().toLocaleDateString("ar-SA")})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 print:grid-cols-4",children:m.map((o,l)=>n.jsxs("div",{className:"glass-panel p-5 rounded-2xl print:border print:border-gray-200 print:bg-white",children:[n.jsxs("div",{className:"flex items-start justify-between mb-3",children:[n.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${o.trend==="up"?"bg-emerald-500/20":"bg-amber-500/20"}`,children:n.jsx(o.icon,{className:`w-5 h-5 ${o.trend==="up"?"text-emerald-400":"text-amber-400"} print:text-black`})}),n.jsxs("div",{className:`flex items-center gap-1 text-sm font-medium ${o.trend==="up"?"text-emerald-400":"text-amber-400"} print:text-black`,children:[o.trend==="up"?n.jsx(S,{className:"w-4 h-4"}):n.jsx(D,{className:"w-4 h-4"}),o.change]})]}),n.jsx("p",{className:"text-2xl font-bold text-white mb-1 print:text-black",children:o.value}),n.jsx("p",{className:"text-gray-400 text-sm print:text-gray-600",children:o.label})]},l))}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 print:grid-cols-2",children:[n.jsxs("div",{className:"lg:col-span-2 glass-panel p-6 rounded-2xl print:border print:border-gray-200 print:text-black print:bg-white",children:[n.jsx("h3",{className:"text-xl font-bold text-white mb-6 print:text-black",children:"نمو الطلاب الشهري"}),n.jsx("div",{className:"h-80",children:n.jsx(k,{width:"100%",height:"100%",children:n.jsxs(ee,{data:f,children:[n.jsx("defs",{children:n.jsxs("linearGradient",{id:"colorStudents",x1:"0",y1:"0",x2:"0",y2:"1",children:[n.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),n.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})}),n.jsx(ae,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),n.jsx(oe,{dataKey:"month",stroke:"#9ca3af"}),n.jsx(ie,{stroke:"#9ca3af"}),n.jsx(C,{contentStyle:{backgroundColor:"rgba(0,0,0,0.8)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",color:"#fff"}}),n.jsx(te,{type:"monotone",dataKey:"students",stroke:"#10b981",strokeWidth:3,fillOpacity:1,fill:"url(#colorStudents)",name:"الطلاب"})]})})})]}),n.jsxs("div",{className:"glass-panel p-6 rounded-2xl print:border print:border-gray-200 print:bg-white",children:[n.jsx("h3",{className:"text-xl font-bold text-white mb-6 print:text-black",children:"توزيع الدورات"}),n.jsx("div",{className:"h-64",children:n.jsx(k,{width:"100%",height:"100%",children:n.jsxs(se,{children:[n.jsx(le,{data:h,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:5,dataKey:"value",children:h.map((o,l)=>n.jsx(de,{fill:o.color},`cell-${l}`))}),n.jsx(_,{formatter:o=>n.jsx("span",{className:"text-gray-300 print:text-black",children:o})}),n.jsx(C,{contentStyle:{backgroundColor:"rgba(0,0,0,0.8)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",color:"#fff"}})]})})})]})]}),n.jsxs("div",{className:"glass-panel p-6 rounded-2xl print:border print:border-gray-200 print:bg-white",children:[n.jsx("h3",{className:"text-xl font-bold text-white mb-6 print:text-black",children:"أكثر الدورات شعبية"}),n.jsx("div",{className:"space-y-4",children:u.map((o,l)=>n.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 rounded-xl hover:bg-white/10 transition-colors print:border print:border-gray-100 print:bg-gray-50",children:[n.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center text-white font-bold",children:l+1}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"text-white font-medium print:text-black",children:o.name}),n.jsxs("p",{className:"text-gray-400 text-sm print:text-gray-600",children:[o.students," طالب"]})]}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-32 h-2 bg-white/10 rounded-full overflow-hidden print:bg-gray-200",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full",style:{width:`${o.students/(u[0].students||1)*100}%`}})}),n.jsxs("div",{className:`flex items-center gap-1 text-sm font-medium ${o.growth>=0?"text-emerald-400":"text-red-400"}`,children:[o.growth>=0?n.jsx(S,{className:"w-4 h-4"}):n.jsx(D,{className:"w-4 h-4"}),Math.abs(o.growth),"%"]})]})]},l))})]})]})};export{Fe as default};
