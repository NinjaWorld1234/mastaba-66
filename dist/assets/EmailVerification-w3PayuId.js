import{u as I,a as M,r as n,j as e,p as T,b as N}from"./index-bJQP0_Bo.js";import{C as $}from"./circle-check-CM4KZ6z6.js";import{M as F}from"./mail-C9g6m6_D.js";import{L as v}from"./loader-circle-DToCjPWM.js";const Y=({email:f,onSuccess:E,onBack:C})=>{const{language:a}=I(),{login:K}=M(),[u,d]=n.useState(["","","","","",""]),[h,p]=n.useState(!1),[x,g]=n.useState(!1),[j,o]=n.useState(""),[R,S]=n.useState(!1),[i,b]=n.useState(60),[m,w]=n.useState(!1),l=n.useRef([]);n.useEffect(()=>{if(i>0&&!m){const r=setTimeout(()=>b(i-1),1e3);return()=>clearTimeout(r)}else i===0&&w(!0)},[i,m]);const D=(r,t)=>{var c;if(!/^\d*$/.test(t))return;const s=[...u];s[r]=t.slice(-1),d(s),o(""),t&&r<5&&((c=l.current[r+1])==null||c.focus()),s.every(O=>O)&&s.join("").length===6&&y(s.join(""))},V=(r,t)=>{var s;t.key==="Backspace"&&!u[r]&&r>0&&((s=l.current[r-1])==null||s.focus())},k=r=>{r.preventDefault();const t=r.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(t.length===6){const s=t.split("");d(s),y(t.join(""))}},y=async r=>{var t;p(!0),o("");try{const{success:s,error:c}=await N.verifyOtp(f,r);if(c)throw new Error(a==="ar"?c.message||"فشل التحقق":c.message||"Verification failed");if(!s)throw new Error(a==="ar"?"رمز غير صحيح":"Invalid code");localStorage.removeItem("pendingVerificationEmail"),S(!0),setTimeout(()=>{E()},1500)}catch(s){o(s instanceof Error?s.message:"Verification failed"),d(["","","","","",""]),(t=l.current[0])==null||t.focus()}finally{p(!1)}},L=async()=>{var r;if(!(!m||x)){g(!0),o("");try{const{error:t}=await N.resendOtp(f);if(t)throw new Error(a==="ar"?t.message||"فشل إعادة الإرسال":t.message||"Failed to resend code");b(60),w(!1),d(["","","","","",""]),(r=l.current[0])==null||r.focus()}catch(t){o(t instanceof Error?t.message:"Failed to resend code")}finally{g(!1)}}};return R?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-panel w-full max-w-md p-8 rounded-[2.5rem] text-center animate-fade-in border border-white/20 shadow-2xl",children:[e.jsx("div",{className:"w-20 h-20 bg-emerald-600/20 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce",children:e.jsx($,{className:"w-10 h-10 text-emerald-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:a==="ar"?"تم التحقق بنجاح!":"Verification Successful!"}),e.jsx("p",{className:"text-gray-400",children:a==="ar"?"جاري تحويلك إلى لوحة التحكم...":"Redirecting to dashboard..."})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-panel w-full max-w-md p-8 rounded-[2.5rem] relative overflow-hidden animate-fade-in border border-white/20 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-600/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(F,{className:"w-8 h-8 text-emerald-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:a==="ar"?"تحقق من بريدك":"Verify Your Email"}),e.jsx("p",{className:"text-gray-400 text-sm",children:a==="ar"?"أرسلنا رمز تحقق مكون من 6 أرقام إلى":"We sent a 6-digit verification code to"}),e.jsx("p",{className:"text-emerald-400 font-medium mt-1",children:f})]}),j&&e.jsx("div",{className:"bg-red-500/20 border border-red-500/50 rounded-xl p-3 mb-4 text-red-300 text-sm text-center",children:j}),e.jsx("div",{className:"flex justify-center gap-2 mb-6",dir:"ltr",children:u.map((r,t)=>e.jsx("input",{ref:s=>l.current[t]=s,type:"text",inputMode:"numeric",maxLength:1,value:r,onChange:s=>D(t,s.target.value),onKeyDown:s=>V(t,s),onPaste:k,disabled:h,className:"w-12 h-14 text-center text-2xl font-bold bg-black/30 border border-white/10 rounded-xl text-white focus:outline-none focus:border-emerald-500 transition-colors disabled:opacity-50"},t))}),h&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-emerald-400 mb-4",children:[e.jsx(v,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:a==="ar"?"جاري التحقق...":"Verifying..."})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:a==="ar"?"لم تستلم الرمز؟":"Didn't receive the code?"}),m?e.jsxs("button",{onClick:L,disabled:x,className:"text-emerald-400 hover:text-emerald-300 font-medium flex items-center justify-center gap-2 mx-auto transition-colors disabled:opacity-50",children:[x?e.jsx(v,{className:"w-4 h-4 animate-spin"}):e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:a==="ar"?"إعادة الإرسال":"Resend Code"})]}):e.jsx("p",{className:"text-gray-500 text-sm",children:a==="ar"?`إعادة الإرسال خلال ${i} ثانية`:`Resend in ${i} seconds`})]}),e.jsx("button",{onClick:C,className:"w-full mt-6 py-3 rounded-xl bg-gray-700 hover:bg-gray-600 text-white font-medium transition-colors",children:a==="ar"?"تغيير البريد الإلكتروني":"Change Email"})]})})};export{Y as default};
