import{d as b,r,j as e,n as C,c as o,v as D,C as F,O as z,D as A}from"./index-PO4O9_Fr.js";import{C as M}from"./clock-DV4-bnDj.js";import{H as $,U as R}from"./upload-T5jrmAXN.js";import{S as L}from"./save-D0iCKTwe.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],j=b("cloud",E);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],w=b("database",I),T=()=>{var g,f;const i=r.useRef(null),[c,d]=r.useState([]),[N,m]=r.useState(!1),[a,u]=r.useState({autoBackup:!1,cloudStorage:!1,retention:"30"}),x=async t=>{if(!t){d([]);return}m(!0);try{const l=((await o.r2.listFiles("backups/")).files||[]).map(n=>({id:n.id||n.fullName,name:n.name||n.fullName.split("/").pop(),date:new Date(n.lastModified||Date.now()).toLocaleString("en-CA"),size:((n.size||0)/1024/1024).toFixed(2)+" MB",status:"success",type:"cloud",url:n.url})).sort((n,_)=>new Date(_.date).getTime()-new Date(n.date).getTime());d(l)}catch(s){console.error("Failed to fetch R2 backups",s)}finally{m(!1)}};r.useEffect(()=>{(async()=>{try{const s=await o.getBackupSettings(),l=s.cloud_backup_enabled;u({autoBackup:s.auto_backup_enabled,cloudStorage:l,retention:s.backup_retention_days||"30"}),x(l)}catch(s){console.error("Failed to load backup settings",s)}})()},[]);const h=async t=>{const s={...a,[t]:!a[t]};u(s);try{await o.updateBackupSettings({auto_backup_enabled:s.autoBackup,cloud_backup_enabled:s.cloudStorage,backup_retention_days:s.retention}),t==="cloudStorage"&&x(s.cloudStorage)}catch(l){console.error("Failed to save setting",l),u(a)}},p=async()=>{try{await o.downloadBackup();const t={id:Date.now(),name:"نسخة محلية (Database)",date:new Date().toLocaleString("en-CA"),size:"Unknown",status:"success",type:"manual"};d([t,...c]),alert("تم تحميل النسخة الاحتياطية بنجاح")}catch(t){alert("فشل إنشاء النسخة الاحتياطية"),console.error(t)}},y=async()=>{try{const t=await o.uploadCloudBackup();alert(`تم الرفع للسحابة بنجاح! الملف: ${t.key}`);const s={id:Date.now(),name:"نسخة سحابية (S3)",date:new Date().toLocaleString("en-CA"),size:(t.size/1024/1024).toFixed(2)+" MB",status:"success",type:"auto",url:t.url};d([s,...c]),x(a.cloudStorage)}catch(t){alert("فشل الرفع للسحابة. تأكد من إعدادات S3/R2."),console.error(t)}},v=()=>{var t;confirm("تحذير: استعادة النسخة الاحتياطية ستقوم باستبدال جميع البيانات الحالية. هل أنت متأكد؟")&&((t=i.current)==null||t.click())},k=async t=>{var l;const s=(l=t.target.files)==null?void 0:l[0];if(s){if(confirm("هل أنت متأكد من استعادة هذه النسخة؟ سيتم فقدان التغييرات غير المحفوظة."))try{await o.restoreBackup(s),alert("تم استعادة النسخة الاحتياطية بنجاح! سيتم إعادة تحميل الصفحة."),window.location.reload()}catch(n){alert("فشل استعادة النسخة الاحتياطية"),console.error(n)}i.current&&(i.current.value="")}},S=[{label:"آخر نسخة",value:((f=(g=c[0])==null?void 0:g.date)==null?void 0:f.split(" ")[0])||"لا يوجد",icon:M,color:"from-emerald-500 to-teal-600"},{label:"حجم التخزين",value:c.length>0?c.reduce((t,s)=>t+parseFloat(s.size),0).toFixed(1)+" MB":"0 MB",icon:$,color:"from-blue-500 to-cyan-600"},{label:"النسخ المحفوظة",value:c.length.toString(),icon:w,color:"from-violet-500 to-purple-600"},{label:"التخزين السحابي",value:a.cloudStorage?"سحابي (R2)":"محلي فقط",icon:j,color:a.cloudStorage?"from-blue-400 to-indigo-500":"from-amber-500 to-orange-600"}],B=t=>{t.url?window.open(t.url,"_blank"):p()};return e.jsxs("div",{className:"animate-fade-in space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"النسخ الاحتياطي"}),e.jsx("p",{className:"text-gray-300",children:"إدارة النسخ الاحتياطية والاستعادة"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"file",ref:i,className:"hidden",accept:".sqlite",onChange:k}),e.jsxs("button",{onClick:v,className:"px-6 py-3 bg-white/5 border border-white/10 text-white rounded-xl font-bold hover:bg-white/10 flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:"استعادة"})]}),e.jsxs("button",{onClick:p,className:"px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-bold hover:opacity-90 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{children:"تحميل محلي"})]}),e.jsxs("button",{onClick:y,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-bold hover:opacity-90 flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5"}),e.jsx("span",{children:"رفع سحابي"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:S.map((t,s)=>e.jsx("div",{className:"glass-panel p-5 rounded-2xl",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-br ${t.color} flex items-center justify-center`,children:e.jsx(t.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-white",children:t.value}),e.jsx("p",{className:"text-gray-400 text-sm",children:t.label})]})]})},s))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-panel p-6 rounded-2xl",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"})," إعدادات النسخ التلقائي"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"النسخ التلقائي"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"نسخ احتياطي يومي الساعة 3 صباحاً"})]}),e.jsx("div",{onClick:()=>h("autoBackup"),className:`w-12 h-6 rounded-full relative cursor-pointer transition-colors ${a.autoBackup?"bg-emerald-500":"bg-gray-600"}`,children:e.jsx("div",{className:`absolute top-1 w-4 h-4 bg-white rounded-full transition-all ${a.autoBackup?"left-7":"left-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"التخزين السحابي"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"رفع تلقائي إلى السحابة"})]}),e.jsx("div",{onClick:()=>h("cloudStorage"),className:`w-12 h-6 rounded-full relative cursor-pointer transition-colors ${a.cloudStorage?"bg-emerald-500":"bg-gray-600"}`,children:e.jsx("div",{className:`absolute top-1 w-4 h-4 bg-white rounded-full transition-all ${a.cloudStorage?"left-7":"left-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"الاحتفاظ بالنسخ"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"حذف النسخ الأقدم من الكود المختار"})]}),e.jsxs("select",{value:a.retention,onChange:async t=>{const s=t.target.value;u(l=>({...l,retention:s}));try{await o.updateBackupSettings({auto_backup_enabled:a.autoBackup,cloud_backup_enabled:a.cloudStorage,backup_retention_days:s})}catch(l){console.error("Failed to save retention",l)}},className:"bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-emerald-500",children:[e.jsx("option",{value:"30",children:"30 يوم"}),e.jsx("option",{value:"60",children:"60 يوم"}),e.jsx("option",{value:"90",children:"90 يوم"})]})]})]})]}),e.jsxs("div",{className:"glass-panel p-6 rounded-2xl",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"})," النسخ الأخيرة"]}),e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto custom-scrollbar pr-1",children:N?e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-gray-400 gap-2",children:[e.jsx(D,{className:"w-6 h-6 animate-spin"}),e.jsx("p",{className:"text-sm",children:"جاري جلب النسخ من السحابة..."})]}):c.length===0?e.jsxs("div",{className:"text-center py-10 text-gray-500",children:[e.jsx("p",{children:"لا توجد نسخ احتياطية حالياً"}),!a.cloudStorage&&e.jsx("p",{className:"text-xs mt-1",children:"قم بتفعيل التخزين السحابي لرؤية النسخ السحابية"})]}):c.map(t=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-white/5 rounded-xl hover:bg-white/10 transition-colors",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${t.status==="success"?"bg-emerald-500/20":"bg-red-500/20"}`,children:t.status==="success"?e.jsx(F,{className:"w-5 h-5 text-emerald-400"}):e.jsx(z,{className:"w-5 h-5 text-red-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium text-sm truncate",title:t.name,children:t.name}),e.jsxs("p",{className:"text-gray-400 text-[10px]",children:[t.date," • ",t.size]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>B(t),className:"p-2 rounded-lg bg-white/5 text-gray-400 hover:text-white",title:"تحميل النسخة",children:e.jsx(A,{className:"w-4 h-4"})})})]},t.id))})]})]})]})},q=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"}));export{T as A,w as D,q as a};
