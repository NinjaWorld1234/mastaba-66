import{r,u as L,a as K,b as U,s as O,j as e,F as R,L as P,A as Z,B as z,X,c as w}from"./index-PO4O9_Fr.js";import{R as q}from"./RatingBox-DyT5Ywyi.js";import{Z as G,n as H}from"./notificationManager-0ERzlaZt.js";import{C as J}from"./clock-DV4-bnDj.js";import{P as N}from"./play-CRP0G9QH.js";import{R as Q}from"./CategoricalChart-Bhcfe9zC.js";import{P as V,a as W}from"./PieChart-z8ZEuvv-.js";import{C as Y}from"./PolarChart-BfX2FAjY.js";import"./star-DEkBOYX3.js";import"./globe-H-Auzyor.js";import"./trash-2-B1SjAVum.js";import"./send-DS51h8Hw.js";import"./index-omCimLjr.js";const _=r.memo(({badge:s})=>e.jsxs("div",{className:`group relative flex flex-col items-center justify-center p-3 rounded-xl transition-all duration-300 cursor-pointer ${s.isUnlocked?"bg-gradient-to-b from-white/10 to-transparent border border-emerald-500/20 hover:border-emerald-500/50":"bg-white/5 opacity-40 grayscale"}`,role:"listitem","aria-label":`${s.title} - ${s.isUnlocked?"Unlocked":"Locked"}`,children:[e.jsxs("div",{className:"w-8 h-8 relative flex items-center justify-center mb-2",children:[e.jsx(s.icon,{className:`w-5 h-5 ${s.isUnlocked?"text-emerald-400":"text-gray-400"}`,"aria-hidden":"true"}),s.isUnlocked&&e.jsx("div",{className:"absolute inset-0 bg-emerald-400/20 blur-md rounded-full"})]}),e.jsx("h4",{className:"font-bold text-[9px] text-center text-gray-300 truncate w-full",children:s.title})]}));_.displayName="BadgeItem";const T=r.memo(({course:s,language:n,onPlay:c})=>{const l=r.useCallback(()=>c(s),[s,c]),b=r.useCallback(o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),c(s))},[s,c]);return e.jsxs("div",{className:"glass-panel p-3 rounded-xl flex gap-3 items-center group cursor-pointer glass-card-hover relative overflow-hidden bg-[#0a1f1c] hover:bg-[#0f2e29] border border-white/5",onClick:l,onKeyDown:b,role:"button",tabIndex:0,"aria-label":`${n==="ar"?s.title:s.titleEn} - ${s.progress}% complete`,children:[e.jsx("div",{className:"absolute bottom-0 left-0 h-0.5 bg-emerald-500/20 w-full","aria-hidden":"true",children:e.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${s.progress}%`}})}),e.jsxs("div",{className:"relative w-16 h-16 flex-shrink-0 rounded-lg overflow-hidden border border-white/10 shadow-md",children:[e.jsx("img",{src:s.thumbnail,alt:"",className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",loading:"lazy"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(N,{className:"w-6 h-6 text-white fill-current opacity-80","aria-hidden":"true"})})]}),e.jsxs("div",{className:"flex-1 min-w-0 py-0.5",children:[e.jsx("span",{className:"text-[9px] font-bold text-emerald-400 mb-0.5 block",children:n==="ar"?s.category:s.categoryEn}),e.jsx("h4",{className:"font-bold text-white text-sm truncate leading-tight mb-1 group-hover:text-emerald-300 transition-colors",children:n==="ar"?s.title:s.titleEn}),e.jsx("p",{className:"text-[10px] text-gray-400 truncate flex items-center gap-1",children:n==="ar"?s.instructor:s.instructorEn})]}),e.jsx("div",{className:"flex flex-col items-end justify-center pl-2 border-l border-white/5 h-full",children:e.jsxs("span",{className:"text-[10px] font-bold text-white",children:[s.progress,"%"]})})]})});T.displayName="CourseCard";const ee=r.memo(({onPlayCourse:s,setActiveTab:n,unreadCount:c})=>{const{t:l,language:b}=L(),{user:o}=K(),[g,y]=r.useState([]),[F,k]=r.useState([]),[p,C]=r.useState(""),[f,I]=r.useState(!1),[x,M]=r.useState(!1),v=U();r.useEffect(()=>{const t=async()=>{try{const[d,i]=await Promise.all([w.getCourses(),w.getFolders()]);y(Array.isArray(d)?d:[]),k(Array.isArray(i)?i:[])}catch{y([]),k([])}},a=async()=>{try{const i=(await w.getAnnouncements())[0];i&&localStorage.getItem("lastSeenAnnouncementId")!==i.id&&(localStorage.setItem("lastSeenAnnouncementId",i.id),H.show("تعميم إداري جديد",i.title,"/icons/icon-192x192.png"))}catch{}};t(),a();const m=setInterval(a,6e4);return()=>clearInterval(m)},[]);const A=r.useCallback(async()=>{if(p.trim()){I(!0);try{await O.sendComplaint(p),v.success(l("dashboard.complaintSuccess")),C("")}catch{v.error(l("dashboard.complaintError"))}finally{I(!1)}}},[p,l,v]),E=()=>M(!x),j=r.useCallback(t=>{n==null||n(t)},[n]),B=r.useCallback(t=>a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),j(t))},[j]),h=r.useMemo(()=>g.filter(t=>t.isEnrolled),[g]),u=r.useMemo(()=>{if(!Array.isArray(h)||h.length===0)return 0;const t=h.reduce((a,m)=>{const d=m&&typeof m.progress=="number"?m.progress:0;return a+d},0);return Math.round(t/h.length)},[h]),S=r.useMemo(()=>[{name:"Completed",value:u},{name:"Remaining",value:100-u}],[u]),$=r.useMemo(()=>["#10b981","rgba(255,255,255,0.1)"],[]);return r.useMemo(()=>h.slice(0,4),[h]),o&&typeof o.points=="number"&&o.points,o&&typeof o.streak=="number"&&o.streak,o&&typeof o.level=="number"&&o.level,e.jsx("div",{className:"space-y-6 animate-fade-in pb-20 lg:pb-10 relative",role:"main","aria-label":l("dashboard.title")||"Dashboard",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-1",children:e.jsxs("h3",{className:"text-base font-bold text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-1 rounded bg-violet-500/20 border border-violet-500/30",children:e.jsx(R,{className:"w-3 h-3 text-violet-400 fill-current"})}),l("dashboard.availableCourses")||"الدورات المتاحة"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:g.sort((t,a)=>(t.orderIndex||0)-(a.orderIndex||0)).map((t,a)=>{const m=F.find(D=>D.id===t.folderId),d=a>0?g[a-1]:null,i=d?(d.progress||0)<100:!1;return e.jsxs("div",{className:"glass-panel p-0 rounded-xl overflow-hidden group hover:border-violet-500/50 transition-all relative flex flex-col bg-[#0a1815]",children:[e.jsxs("div",{className:"h-32 w-full relative overflow-hidden",children:[e.jsx("img",{src:t.thumbnail,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110",loading:"lazy"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 group-hover:bg-black/20 transition-colors"}),m&&e.jsxs("div",{className:"absolute top-2 right-2 px-2 py-1 bg-black/60 backdrop-blur-md rounded-lg text-[9px] font-bold text-gray-300 border border-white/10 flex items-center gap-1 z-10",children:[e.jsx(R,{className:"w-3 h-3 text-violet-400"}),e.jsx("span",{className:"truncate max-w-[100px]",children:m.name})]}),i&&e.jsxs("div",{className:"absolute inset-0 bg-black/30 flex flex-col items-center justify-center z-20",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 flex items-center justify-center mb-2 border border-white/20",children:e.jsx(P,{className:"w-6 h-6 text-gray-400"})}),e.jsx("span",{className:"text-[10px] font-bold text-gray-300 px-3 py-1 bg-black/50 rounded-full border border-white/10",children:"أكمل الدورة السابقة لفتح هذه الدورة"})]})]}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsx("h4",{className:"font-bold text-white text-sm mb-1 line-clamp-1 group-hover:text-violet-300 transition-colors",children:b==="ar"?t.title:t.titleEn}),e.jsxs("div",{className:"text-[10px] text-gray-400 mb-4 flex items-center gap-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),t.duration]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-3 h-3"}),t.lessonsCount||0," درس"]})]}),e.jsx("button",{onClick:()=>!i&&s(t),disabled:i,className:`mt-auto w-full py-2 rounded-lg text-xs font-bold transition-all flex items-center justify-center gap-2 group/btn
                                    ${i?"bg-white/5 text-gray-500 cursor-not-allowed border border-white/5":"bg-white/5 hover:bg-violet-600 hover:text-white text-gray-300"}`,children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"مغلق مؤقتاً"}),e.jsx(P,{className:"w-3 h-3"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"انتقال للدورة"}),e.jsx(Z,{className:"w-3 h-3 group-hover/btn:-translate-x-1 transition-transform rtl:rotate-180"})]})})]})]},t.id)})})]}),e.jsxs("div",{className:"space-y-4",role:"complementary",children:[c!==void 0&&c>0?e.jsxs("div",{onClick:()=>n==null?void 0:n("messages"),className:"bg-gradient-to-r from-violet-600/30 via-indigo-600/20 to-transparent border border-violet-500/40 p-4 rounded-xl flex items-center justify-between cursor-pointer group hover:border-violet-400/60 transition-all backdrop-blur-xl relative z-30 shadow-xl shadow-violet-900/10 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-violet-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"flex items-center gap-3 relative z-10 w-full",children:[e.jsxs("div",{className:"w-10 h-10 bg-gradient-to-br from-violet-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg shadow-violet-900/50 group-hover:scale-110 group-hover:rotate-3 transition-all duration-500 relative flex-shrink-0",children:[e.jsx(z,{className:"w-5 h-5 text-white"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-[#0a1f1c] animate-pulse"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-white font-bold text-xs leading-tight group-hover:text-violet-200 transition-colors mb-0.5",children:"رسائل جديدة!"}),e.jsxs("p",{className:"text-violet-200/80 text-[10px] font-medium truncate",children:[" لديك ",e.jsx("span",{className:"text-white font-bold",children:c})," رسائل غير مقروءة"]})]}),e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-violet-500/30 group-hover:bg-violet-500/50 transition-all border border-violet-400/30 flex-shrink-0",children:e.jsx(N,{className:"w-3 h-3 rotate-180 fill-current text-white"})})]})]}):null,e.jsxs("div",{className:`glass-panel p-5 rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl group hover:border-violet-500/30 transition-all duration-500 shadow-2xl overflow-hidden cursor-pointer ${x?"ring-2 ring-violet-500/20":""}`,onClick:x?void 0:E,children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-violet-600/10 blur-[40px] rounded-full -translate-y-1/2 translate-x-1/2 group-hover:bg-violet-600/20 transition-all duration-700"}),e.jsx("div",{className:"flex items-center justify-between relative z-10 h-full",children:e.jsxs("div",{className:`flex items-center gap-3 ${x?"w-full mb-4":""}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-violet-600 to-indigo-700 flex items-center justify-center shadow-lg shadow-violet-600/30 group-hover:scale-110 transition-transform duration-500",children:e.jsx(z,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-bold text-white tracking-tight leading-tight",children:l("dashboard.complaintsBox")}),!x&&e.jsx("p",{className:"text-[9px] text-violet-400 font-medium",children:"شاركنا رأيك"})]}),x&&e.jsx("button",{onClick:t=>{t.stopPropagation(),E()},className:"p-1.5 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:e.jsx(X,{className:"w-4 h-4"})})]})}),x&&e.jsxs("div",{className:"mt-2 space-y-3 relative z-10 animate-in fade-in slide-in-from-top-2 duration-400",onClick:t=>t.stopPropagation(),children:[e.jsx("textarea",{value:p,onChange:t=>C(t.target.value),placeholder:l("dashboard.complaintsPlaceholder"),className:"w-full h-32 bg-black/40 border border-white/10 rounded-xl p-3 text-xs text-white focus:outline-none focus:border-violet-500/50 focus:ring-2 focus:ring-violet-500/10 transition-all placeholder:text-gray-600 resize-none custom-scrollbar"}),e.jsx("button",{onClick:A,disabled:!p.trim()||f,className:`
                              w-full px-4 py-2 rounded-full font-bold text-[10px] transition-all flex items-center justify-center gap-2 relative overflow-hidden group/btn
                              ${!p.trim()||f?"bg-white/5 text-gray-500 cursor-not-allowed border border-white/5":"bg-violet-600 hover:bg-violet-500 text-white shadow-lg shadow-violet-600/20"}
                           `,children:f?e.jsx("div",{className:"w-3 h-3 border-2 border-white/20 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:l("dashboard.sendComplaint")}),e.jsx(G,{className:"w-3 h-3 fill-current"})]})})]})]}),e.jsxs("div",{onClick:()=>j("progress"),onKeyDown:B("progress"),className:"glass-panel rounded-2xl p-4 flex items-center justify-between relative overflow-hidden group bg-gradient-to-br from-[#064e3b] to-[#022c22] cursor-pointer",role:"button",tabIndex:0,"aria-label":`${l("dashboard.courseProgress")} - ${u}% ${l("dashboard.completed")}`,children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-gray-300 mb-1 group-hover:text-emerald-300 transition-colors",children:l("dashboard.courseProgress")}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-2xl font-black text-white",children:[u,"%"]}),e.jsx("span",{className:"text-[10px] text-emerald-400",children:l("dashboard.completed")})]})]}),e.jsx("div",{className:"w-16 h-16 relative","aria-hidden":"true",children:e.jsx(Q,{width:"100%",height:"100%",children:e.jsx(V,{children:e.jsx(W,{data:S,innerRadius:20,outerRadius:30,startAngle:90,endAngle:-270,dataKey:"value",stroke:"none",children:S.map((t,a)=>e.jsx(Y,{fill:$[a%$.length],cornerRadius:4},`cell-${a}`))})})})})]}),e.jsx(q,{})]})]})})});ee.displayName="Dashboard";export{ee as default};
