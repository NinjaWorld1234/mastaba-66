import{d as w,a as Ne,b as ye,r as i,c as k,R as ke,j as e,U as ie,B as oe,X as P,S as Se}from"./index-PO4O9_Fr.js";import{n as Ce,Z as Me}from"./notificationManager-0ERzlaZt.js";import{L as de}from"./loader-qDZSFkpB.js";import{C as Ie}from"./check-4m4axsU5.js";import{T as Re}from"./trash-2-B1SjAVum.js";import{S as Le}from"./send-DS51h8Hw.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Te=w("check-check",Ue);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],Ae=w("circle-stop",_e);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],ce=w("file",$e);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],Ee=w("menu",De);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],O=w("mic",Fe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],xe=w("paperclip",Be),Ke=({initialSelectedUserId:W})=>{const{user:a}=Ne(),S=ye(),[m,T]=i.useState([]),[j,me]=i.useState([]),[o,b]=i.useState(null),[C,q]=i.useState(""),[_,Z]=i.useState(!0),[A,G]=i.useState(!1),[K,$]=i.useState(!1),[M,he]=i.useState(""),[Q,I]=i.useState(null),[V,X]=i.useState(!1),[ze,pe]=i.useState(null),[n,R]=i.useState(null),[L,J]=i.useState(!1),[ue,D]=i.useState(0),[H,U]=i.useState(null),E=i.useRef(null),F=i.useRef(null),v=i.useRef(null),Y=i.useRef(null),B=((a==null?void 0:a.role)||"").toLowerCase(),u=B==="admin",N=B==="supervisor",ee=B==="student";i.useEffect(()=>{fe();const t=setInterval(se,1e4);return()=>clearInterval(t)},[]),i.useEffect(()=>{te()},[m,o,n,L]);const te=()=>{var t;(t=Y.current)==null||t.scrollIntoView({behavior:"smooth"})},fe=async()=>{Z(!0);try{console.log("[MessagingSystem] loadData started, user role:",a==null?void 0:a.role);const[t,s]=await Promise.all([k.getMessages(),k.getContacts()]);console.log("[MessagingSystem] data loaded:",{msgsCount:t.length,chatUsersCount:s.length,chatUsers:s,currentUser:a}),T(t),me(s);const r=((a==null?void 0:a.role)||"").toLowerCase(),l=r==="admin",d=r==="supervisor",p=r==="student";if(l||d){if(W){const x=s.find(f=>f.id===W);x&&b(x)}}else if(p){const x=s.find(g=>(g.role||"").toLowerCase()==="admin");console.log("[MessagingSystem] Platform Admin found:",x),pe(x||null);const f=(a==null?void 0:a.supervisorId)||(a==null?void 0:a.supervisor_id);if(console.log("[MessagingSystem] Student Supervisor ID:",f),f){const g=s.find(c=>String(c.id)===String(f));g?(console.log("[MessagingSystem] Setting default supervisor selection:",g.name),b(g)):console.warn("[MessagingSystem] Supervisor not found in chatUsers for student")}}}catch(t){console.error("[MessagingSystem] loadData error:",t),S.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„")}finally{Z(!1)}},se=async()=>{try{const t=await k.getMessages();if(t.length>m.length&&m.length>0){const s=t[t.length-1];s.senderId!==(a==null?void 0:a.id)&&Ce.show("Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©",s.content||(s.attachmentType?"Ù…Ù„Ù Ù…Ø±ÙÙ‚":"Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©"),"/icons/icon-192x192.png")}T(t)}catch{}},ge=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(t);E.current=s;const r=[];s.ondataavailable=l=>{l.data.size>0&&r.push(l.data)},s.onstop=()=>{const l=new Blob(r,{type:"audio/webm"}),d=new File([l],"voice-note.webm",{type:"audio/webm"});R(d);const p=URL.createObjectURL(l);U(p),t.getTracks().forEach(x=>x.stop())},s.start(),J(!0),D(0),F.current=setInterval(()=>{D(l=>l+1)},1e3)}catch(t){console.error(t),S.error("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†")}},re=()=>{E.current&&L&&(E.current.stop(),J(!1),F.current&&clearInterval(F.current))},be=()=>{re(),R(null),U(null),D(0)},ve=t=>{const s=Math.floor(t/60),r=t%60;return`${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},we=t=>{var s;if((s=t.target.files)!=null&&s[0]){const r=t.target.files[0],l=5*1024*1024;if(r.size>l){I(`Ù†Ø¹ØªØ°Ø± Ù…Ù†ÙƒØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„ÙØ§Øª Ø£ÙƒØ¨Ø± Ù…Ù† 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª. Ø­Ø¬Ù… Ù…Ù„ÙÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‡Ùˆ ${(r.size/(1024*1024)).toFixed(2)} Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª.`),v.current&&(v.current.value="");return}I(null),R(r),U(null)}},ae=()=>{R(null),U(null),I(null),v.current&&(v.current.value="")},le=async()=>{if(!(!C.trim()&&!n||!o)){if(u&&o.role==="student"&&z().some(t=>t.isComplaint===1)){S.error("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰");return}G(!0);try{if(!o)throw new Error("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ù…Ø±Ø§Ø³Ù„Ø©");const t=o.id;let s,r;if(n){r=n.type.startsWith("image/")?"image":n.type.startsWith("audio/")?"audio":"file",console.log("Sending file to proxy upload (Base64):",n.name);const d=await new Promise((f,g)=>{const c=new FileReader;c.onload=()=>f(c.result),c.onerror=g,c.readAsDataURL(n)}),p=await fetch("/api/social/upload-proxy",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(a==null?void 0:a.access_token)||localStorage.getItem("token")}`},body:JSON.stringify({fileName:n.name,fileType:n.type,base64Data:d})});if(!p.ok)throw new Error("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¹Ø¨Ø± Ø§Ù„Ø®Ø§Ø¯Ù…");const{publicUrl:x}=await p.json();s=x,console.log("Proxy upload (Base64) successful. URL:",x)}const l=await k.sendMessage(t,C,s,r,n==null?void 0:n.name,V);T(d=>[...d,l]),q(""),X(!1),ae(),te()}catch(t){console.error(t),S.error("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©")}finally{G(!1)}}},je=t=>{if(!t.attachmentUrl)return null;let s=t.attachmentName;if(!s)try{const l=new URL(t.attachmentUrl).pathname.split("/"),d=l[l.length-1];s=d.split("-").slice(1).join("-")||d}catch{s="Ù…Ù„Ù Ù…Ø±ÙÙ‚"}return t.attachmentType==="image"?e.jsx("div",{className:"mt-3 group relative",children:e.jsxs("a",{href:t.attachmentUrl,target:"_blank",rel:"noopener noreferrer",className:"block overflow-hidden rounded-xl border border-white/10 hover:border-violet-500/50 transition-all shadow-lg",children:[e.jsx("img",{src:t.attachmentUrl,alt:"attachment",className:"w-full max-w-[300px] object-contain group-hover:scale-105 transition-transform duration-500"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-2 text-[10px] text-white opacity-0 group-hover:opacity-100 transition-opacity",children:s})]})}):t.attachmentType==="audio"?e.jsxs("div",{className:"mt-3 bg-white/5 rounded-xl border border-white/10 p-3 space-y-2 max-w-[280px]",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-violet-300 font-bold mb-1",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsx("span",{children:"ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ"})]}),e.jsx("audio",{controls:!0,src:t.attachmentUrl,className:"w-full h-10 custom-audio-mini"})]}):e.jsxs("a",{href:t.attachmentUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-4 mt-3 p-4 bg-white/5 hover:bg-white/10 rounded-2xl border border-white/10 transition-all group overflow-hidden min-w-[240px]",children:[e.jsx(xe,{className:"w-5 h-5 text-white/40 group-hover:text-white/70 transition-colors shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col items-center text-center",children:[e.jsx("div",{className:"text-sm font-bold text-white truncate w-full",dir:"ltr",children:s}),e.jsxs("div",{className:"text-[10px] text-white/60 mt-1 flex items-center gap-1",children:[e.jsx("span",{children:"Ù…Ù„Ù"}),e.jsx("span",{className:"uppercase",children:t.attachmentUrl.split("?")[0].split(".").pop()||"PDF"})]})]}),e.jsx("div",{className:"p-3 bg-white/5 rounded-xl border border-white/5 group-hover:bg-white/10 transition-colors shrink-0",children:e.jsx(ce,{className:"w-6 h-6 text-white/80"})})]})},z=()=>o?m.filter(t=>t.senderId===(a==null?void 0:a.id)&&t.receiverId===o.id||t.receiverId===(a==null?void 0:a.id)&&t.senderId===o.id):[],h=ke.useMemo(()=>{let t=j;if(M.trim()){const s=M.toLowerCase();t=j.filter(r=>{var l;return r.name.toLowerCase().includes(s)||((l=r.email)==null?void 0:l.toLowerCase().includes(s))})}return t.sort((s,r)=>{const l=m.filter(c=>c.senderId===s.id&&!c.read).length,d=m.filter(c=>c.senderId===r.id&&!c.read).length;if(l!==d)return d-l;const p=m.filter(c=>c.senderId===s.id||c.receiverId===s.id),x=m.filter(c=>c.senderId===r.id||c.receiverId===r.id),f=p.length>0?new Date(p[p.length-1].timestamp).getTime():0;return(x.length>0?new Date(x[x.length-1].timestamp).getTime():0)-f})},[j,m,M]);i.useEffect(()=>{if(u&&!o&&h.length>0&&!K&&!_){const t=h.find(s=>m.some(r=>r.senderId===s.id&&!r.read));b(t||h[0])}},[u,h,_]);const y=t=>{const s=m.filter(d=>d.senderId===t.id&&!d.read).length,r=m.filter(d=>d.senderId===t.id||d.receiverId===t.id).pop(),l=(o==null?void 0:o.id)===t.id;return e.jsxs("button",{onClick:async()=>{if(b(t),$(!1),s>0)try{await k.markConversationAsRead(t.id),se()}catch(d){console.error("Failed to mark read",d)}},className:`w-full p-3 rounded-lg flex items-center gap-3 transition-all duration-200 border ${l?"bg-violet-600/20 border-violet-500/40 shadow-[0_0_15px_rgba(139,92,246,0.1)]":"border-transparent hover:bg-white/5 hover:border-white/5"}`,children:[e.jsxs("div",{className:"relative",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-gray-400"})}),s>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full text-[10px] flex items-center justify-center text-white font-bold animate-pulse shadow-lg shadow-red-500/40",children:s})]}),e.jsxs("div",{className:"flex-1 text-right min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[e.jsx("h4",{className:`text-sm font-bold truncate ${l?"text-white":"text-gray-300"}`,children:t.name}),r&&e.jsx("span",{className:"text-[9px] text-gray-600",children:new Date(r.timestamp).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})]}),r&&e.jsxs("p",{className:`text-[10px] truncate mt-1 flex items-center gap-1 ${s>0?"text-white font-bold":"text-gray-500"}`,children:[r.senderId===(a==null?void 0:a.id)?"Ø£Ù†Øª: ":"",r.attachmentType==="audio"?"ğŸ¤ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ":r.attachmentType==="image"?"ğŸ“· ØµÙˆØ±Ø©":r.attachmentType?"ğŸ“ Ù…Ù„Ù":r.content]})]})]},t.id)},ne=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-white/5 bg-white/5 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center bg-transparent",children:[e.jsx("h3",{className:"font-bold text-white",children:"Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[10px] bg-violet-500/20 text-violet-300 px-2 py-0.5 rounded-full border border-violet-500/30",children:[h.reduce((t,s)=>t+m.filter(r=>r.senderId===s.id&&!r.read).length,0)," ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡"]}),e.jsx("button",{onClick:()=>$(!1),className:"md:hidden text-gray-400",children:e.jsx(P,{})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨...",value:M,onChange:t=>he(t.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-violet-500/50 pr-8"}),e.jsx(Se,{className:"absolute right-2.5 top-2.5 w-4 h-4 text-gray-500"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-4",children:[N&&e.jsxs(e.Fragment,{children:[j.some(t=>(t.role||"").toLowerCase()==="admin")&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"px-3 py-1 text-[10px] font-bold text-violet-400 uppercase tracking-wider flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-3 bg-violet-500 rounded-full"}),"Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…"]}),h.filter(t=>(t.role||"").toLowerCase()==="admin").map(t=>y(t))]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"px-3 py-1 text-[10px] font-bold text-emerald-400 uppercase tracking-wider flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-3 bg-emerald-500 rounded-full"}),"Ø·Ù„Ø§Ø¨ÙŠ"]}),h.filter(t=>(t.role||"").toLowerCase()!=="admin").length===0?e.jsx("p",{className:"text-gray-500 text-center py-2 text-[10px]",children:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ø¨Ø¹Ø¯"}):h.filter(t=>(t.role||"").toLowerCase()!=="admin").map(t=>y(t))]})]}),ee&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"px-3 py-1 text-[10px] font-bold text-violet-400 uppercase tracking-wider flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-3 bg-violet-500 rounded-full"}),"Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø¨Ø§Ø´Ø±"]}),h.filter(t=>(t.role||"").toLowerCase()==="supervisor").length===0?e.jsx("p",{className:"text-gray-500 px-3 py-2 text-[10px]",children:"Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ù…Ø´Ø±Ù Ù„Ùƒ Ø¨Ø¹Ø¯"}):h.filter(t=>(t.role||"").toLowerCase()==="supervisor").map(t=>y(t))]}),u&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"px-3 py-1 text-[10px] font-bold text-violet-400 uppercase tracking-wider flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-3 bg-violet-500 rounded-full"}),"Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"px-3 text-[9px] text-gray-500 mb-1",children:"Ø§Ù„Ù…Ø´Ø±ÙÙˆÙ†"}),h.filter(t=>(t.role||"").toLowerCase()==="supervisor").map(t=>y(t))]}),h.some(t=>(t.role||"").toLowerCase()==="student")&&e.jsxs("div",{children:[e.jsx("p",{className:"px-3 text-[9px] text-red-400 mb-1",children:"Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„Ø·Ù„Ø§Ø¨"}),h.filter(t=>(t.role||"").toLowerCase()==="student").map(t=>y(t))]})]})]})]});return _?e.jsx("div",{className:"flex justify-center p-10",children:e.jsx(de,{className:"animate-spin text-white"})}):e.jsx("div",{className:"flex-1 flex flex-col items-center justify-start p-2 md:p-4 animate-fade-in relative z-10 w-full",children:e.jsxs("div",{className:"w-full max-w-7xl h-[85vh] max-h-[1000px] min-h-[500px] glass-panel overflow-hidden rounded-3xl border border-white/10 relative flex shadow-2xl mx-auto",children:[(u||N||ee)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:flex flex-col w-80 shrink-0 bg-black/20 border-l border-white/5 relative z-20 min-w-[20rem]",children:ne()}),e.jsx("div",{className:`
                            md:hidden fixed inset-y-0 right-0 z-50 w-80 bg-black/95 transition-transform duration-300 border-l border-white/5 flex flex-col
                            ${K?"translate-x-0":"translate-x-full"}
                        `,children:ne()})]}),e.jsxs("div",{className:"flex-1 flex flex-col bg-black/20 relative",children:[e.jsx("div",{className:"p-4 border-b border-white/10 flex justify-between items-start bg-white/5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[(u||N)&&e.jsx("button",{onClick:()=>$(!0),className:"md:hidden p-2 rounded-lg bg-white/5 text-gray-300",children:e.jsx(Ee,{className:"w-5 h-5"})}),o?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-violet-500/20 flex items-center justify-center border border-violet-500/30",children:o.avatar?e.jsx("img",{src:o.avatar,className:"w-full h-full rounded-full object-cover"}):u||N?e.jsx(ie,{className:"w-5 h-5 text-violet-300"}):e.jsx("div",{className:"text-xl",children:"ğŸ“"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white",children:o.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-emerald-400",children:"Ù†Ø´Ø· Ø§Ù„Ø¢Ù†"}),o.role==="admin"&&e.jsx("span",{className:"px-1.5 py-0.5 bg-violet-500/20 text-violet-400 text-[8px] rounded-md border border-violet-500/30 font-bold uppercase",children:"Ù…Ø¯ÙŠØ±"})]})]})]}):e.jsx("h3",{className:"font-bold text-gray-400",children:"Ø§Ø®ØªØ± Ù…Ø­Ø§Ø¯Ø«Ø©"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-4 bg-gradient-to-b from-transparent to-black/20",children:[z().map((t,s)=>{const r=t.senderId===(a==null?void 0:a.id);return e.jsx("div",{className:`flex ${r?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] p-4 rounded-2xl relative group ${r?"bg-violet-600 text-white rounded-tl-sm":"bg-white/10 text-gray-200 rounded-tr-sm"}`,children:[t.isComplaint===1&&e.jsxs("div",{className:"mb-2 flex items-center gap-1.5 px-2 py-0.5 bg-red-500/20 text-red-400 rounded-md border border-red-500/30 w-fit",children:[e.jsx(oe,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",children:"Ø´ÙƒÙˆÙ‰ / Ù…Ù‚ØªØ±Ø­"})]}),t.content&&e.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:t.content}),je(t),e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-[10px] ${r?"text-violet-200":"text-gray-500"}`,children:[e.jsx("span",{children:new Date(t.timestamp).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})}),r&&(t.read?e.jsx(Te,{className:"w-3 h-3"}):e.jsx(Ie,{className:"w-3 h-3"}))]})]})},t.id||s)}),e.jsx("div",{ref:Y})]}),(o||!u&&!N)&&e.jsx("div",{className:"p-4 bg-black/40 border-t border-white/5 backdrop-blur-sm relative",children:u&&(o==null?void 0:o.role)==="student"&&z().some(t=>t.isComplaint===1)?e.jsxs("div",{className:"flex items-center justify-center p-4 bg-red-500/5 rounded-xl border border-red-500/20 text-red-400 text-sm gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),e.jsx("span",{children:"Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù‡ÙŠ Ø´ÙƒÙˆÙ‰/Ù…Ù‚ØªØ±Ø­ Ù…Ù† Ø§Ù„Ø·Ø§Ù„Ø¨. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©."})]}):e.jsxs(e.Fragment,{children:[V&&e.jsxs("div",{className:"mb-3 p-2 bg-red-500/20 border border-red-500/40 rounded-lg text-red-400 text-[10px] flex items-center gap-2",children:[e.jsx(oe,{className:"w-3 h-3"}),e.jsx("span",{children:'Ø£Ù†Øª Ø§Ù„Ø¢Ù† ØªÙ‚ÙˆÙ… Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙƒÙ€ "Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ù…Ù‚ØªØ±Ø­" Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¨Ø§Ø´Ø±Ø©.'}),e.jsx("button",{onClick:()=>{X(!1);const t=(a==null?void 0:a.supervisorId)||(a==null?void 0:a.supervisor_id),s=j.find(r=>r.id===t);s&&b(s)},className:"mr-auto text-white underline",children:"Ø¥Ù„ØºØ§Ø¡"})]}),Q&&e.jsxs("div",{className:"mb-3 p-3 bg-red-500/10 border border-red-500/30 rounded-xl text-red-400 text-xs flex items-center gap-2 animate-in fade-in slide-in-from-top-2",children:[e.jsx("span",{className:"p-1 bg-red-500/20 rounded-full",children:"!"}),e.jsx("span",{children:Q}),e.jsx("button",{onClick:()=>I(null),className:"mr-auto opacity-50 hover:opacity-100",children:e.jsx(P,{className:"w-3 h-3"})})]}),L?e.jsxs("div",{className:"flex items-center gap-4 bg-red-500/10 p-4 rounded-xl border border-red-500/20 animate-pulse",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-ping"}),e.jsx("span",{className:"text-red-400 font-mono font-bold text-lg",children:ve(ue)}),e.jsx("span",{className:"text-sm text-gray-400",children:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„..."}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:be,className:"p-2 text-gray-400 hover:text-white transition-colors",title:"Ø¥Ù„ØºØ§Ø¡",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsx("button",{onClick:re,className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg shadow-red-500/20",title:"Ø¥ÙŠÙ‚Ø§Ù",children:e.jsx(Ae,{className:"w-6 h-6 fill-current"})})]}):n?e.jsx("div",{className:"flex flex-col gap-2 mb-2 animate-in fade-in slide-in-from-bottom-2 duration-300",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-violet-600/10 rounded-xl border border-violet-500/30 w-full shadow-lg backdrop-blur-md",children:[n.type.startsWith("image/")?e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden border border-white/10 shadow-sm",children:e.jsx("img",{src:URL.createObjectURL(n),alt:"preview",className:"w-full h-full object-cover"})}):e.jsx("div",{className:"p-2.5 bg-violet-500/20 rounded-lg",children:n.type.startsWith("audio/")?e.jsx(O,{className:"w-5 h-5 text-violet-400"}):e.jsx(ce,{className:"w-5 h-5 text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-[10px] text-violet-400 font-bold uppercase tracking-wider mb-0.5",children:"Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù"}),e.jsx("div",{className:"text-sm text-white font-medium truncate",dir:"ltr",children:n.name}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:[(n.size/1024).toFixed(1)," KB"]})]}),H&&e.jsx("audio",{controls:!0,src:H,className:"h-8 w-32 md:w-48 ml-2 custom-audio-mini"}),e.jsx("button",{onClick:ae,className:"p-2 transition-colors text-gray-400 hover:text-red-400 bg-white/5 hover:bg-white/10 rounded-lg",title:"Ø¥Ø²Ø§Ù„Ø©",children:e.jsx(P,{className:"w-5 h-5"})})]})}):null,!L&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"file",ref:v,className:"hidden",onChange:we}),e.jsx("button",{onClick:()=>{var t;return(t=v.current)==null?void 0:t.click()},className:"p-3 rounded-xl bg-white/5 text-gray-400 hover:text-white hover:bg-white/10 transition-colors tooltip",title:"Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù",disabled:!!n,children:e.jsx(xe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:ge,className:"p-3 rounded-xl bg-white/5 text-gray-400 hover:text-red-400 hover:bg-white/10 transition-colors",title:"ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ",disabled:!!n,children:e.jsx(O,{className:"w-5 h-5"})})]}),e.jsx("input",{type:"text",value:C,onChange:t=>q(t.target.value),onKeyDown:t=>t.key==="Enter"&&le(),placeholder:n?"Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹...":"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...",className:"flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-violet-500/50 transition-all font-sans",disabled:A}),e.jsx("button",{onClick:le,disabled:!C.trim()&&!n||A,className:"p-3 bg-violet-600 hover:bg-violet-500 disabled:bg-gray-800 disabled:text-gray-500 text-white rounded-xl transition-all shadow-lg shadow-violet-600/20 flex items-center gap-2",children:A?e.jsx(de,{className:"w-5 h-5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden md:inline font-bold text-sm",children:"Ø¥Ø±Ø³Ø§Ù„"}),e.jsx(Le,{className:"w-5 h-5"})]})})]})]})})]})]})})};export{Ke as default};
